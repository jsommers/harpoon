<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html401/loose.dtd">
<html>
<!--This manual is for the Harpoon Flow-level Traffic Generator.  The
following copyright notice covers the Harpoon source code, including
all documentation, images, and ancillary files.

Copyright C 2004-2005, Joel E. Sommers.  All rights reserved.


This file is part of Harpoon, a flow-level traffic generator.

Harpoon is free software; you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation; either version 2 of the License, or
(at your option) any later version.

Harpoon is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with Harpoon; if not, write to the Free Software
Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA

-->
<!-- Created on December, 7 2005 by texi2html 1.70 -->
<!--
Written by: Lionel Cons <Lionel.Cons@cern.ch> (original author)
            Karl Berry  <karl@freefriends.org>
            Olaf Bachmann <obachman@mathematik.uni-kl.de>
            and many others.
Maintained by: Many creative people <dev@texi2html.cvshome.org>
Send bugs and suggestions to <users@texi2html.cvshome.org>

-->
<head>
<title>Harpoon: Harpoon: A Flow-level Traffic Generator</title>

<meta name="description" content="Harpoon: Harpoon: A Flow-level Traffic Generator">
<meta name="keywords" content="Harpoon: Harpoon: A Flow-level Traffic Generator">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="texi2html 1.70">
<meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
pre.display {font-family: serif; font-size: smaller}
pre.format {font-family: serif; font-size: smaller}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
pre.smalldisplay {font-family: serif; font-size: smaller}
pre.smallexample {font-size: smaller}
pre.smallformat {font-family: serif; font-size: smaller}
pre.smalllisp {font-size: smaller}
ul.toc {list-style: none}
-->
</style>


</head>

<body lang="en" bgcolor="#FFFFFF" text="#000000" link="#0000FF" vlink="#800080" alink="#FF0000">

<a name="NOD1"></a>
<a name="SEC_Top"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#SEC48" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>

<IMG SRC="harpoon_icon.png" ALT="harpoon icon" WIDTH="200">

<h1 class="settitle">Harpoon: A Flow-level Traffic Generator</h1>

<h3>User Manual</h3>

<P> A <a href="harpoon_manual.pdf">pdf</a> version of this document is available.  </P>

<P> The software is available from the 
<a href="https://github.com/jsommers/harpoon">Harpoon github repository.</a></P>

<br>
<hr>
<P>Release history in brief:
<ul>
<li>June 2004, Initial release (SIGMETRICS).
<li>September 2004, Updated release (Internet Measurement Conference).
<li>December 2005, Updated release (Relicensed as GPL; various bug fixes).
</ul>
<P>Older versions of Harpoon may be obtained if desired - just ask.</P>
<hr>

<p>This manual is for the Harpoon Flow-level Traffic Generator.  The
following copyright notice covers the Harpoon source code, including
all documentation, images, and ancillary files.

</p><p>Copyright &copy; 2004-2005, Joel E. Sommers.  All rights reserved.

</p><blockquote>
<p>This file is part of Harpoon, a flow-level traffic generator.

</p><p>Harpoon is free software; you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation; either version 2 of the License, or
(at your option) any later version.

</p><p>Harpoon is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

</p><p>You should have received a copy of the GNU General Public License
along with Harpoon; if not, write to the Free Software
Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
</p></blockquote>



<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#SEC1">1. Overview of Harpoon</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top"> A general discussion of what Harpoon is and what it does.
</td></tr>
<tr><td align="left" valign="top"><a href="#SEC5">2. Basic Configuration</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top"> How to generate traffic using the example configuration files.
</td></tr>
<tr><td align="left" valign="top"><a href="#SEC10">3. Advanced Configuration</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top"> How to generate configuration files and traffic from your own traces.
</td></tr>
<tr><td align="left" valign="top"><a href="#SEC21">4. Running Harpoon</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top"> Command-line switches to Harpoon, general overview of starting, stopping, and loading config files.
</td></tr>
<tr><td align="left" valign="top"><a href="#SEC32">5. Managing harpoon</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top"> Tools and guidelines for managing a large-scale installation of Harpoon daemons.
</td></tr>
<tr><td align="left" valign="top"><a href="#SEC39">A. More Examples</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top"> Examples of XML configuration files, scenarios of running and managing Harpoon.
</td></tr>
<tr><td align="left" valign="top"><a href="#SEC46">C. Creating New Traffic Generation Modules</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top"> So you don't like the traffic generation modules we give you?  Write your own!
</td></tr>
<tr><td align="left" valign="top"><a href="#SEC47">Postscript</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top"> History and acknowledgements.
</td></tr>
<tr><td align="left" valign="top"><a href="#SEC48">Index</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top"> Index of key terms.
</td></tr>
</table>




<hr size="1">
<a name="NOD2"></a>
<a name="SEC1"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#SEC_Top" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC2" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[ &lt;&lt; ]</td>
<td valign="middle" align="left">[<a href="#SEC_Top" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#SEC5" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#SEC48" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h1 class="chapter"> 1. Overview of Harpoon </h1>

<p>Harpoon is a flow-level traffic generator.  It uses a set of
distributional parameters that can be automatically extracted from
Netflow traces to generate flows that exhibit the same statistical
qualities present in measured Internet traces, including temporal and
spatial characteristics.  Harpoon can be used to generate
representative background traffic for application or protocol testing,
or for testing network switching hardware.  This manual begins by
describing the architecture of Harpoon.  Subsequent chapters describe
how to effectively configure, run, and manage Harpoon.

</p><a name="IDX1"></a>
<p>A suggested roadmap for getting up and running with Harpoon is to read
this chapter, <a href="#SEC1">Overview of Harpoon</a>, followed by the next
chapter, <a href="#SEC5">Basic Configuration</a>, referring as needed to 
<a href="#SEC21">Running Harpoon</a> and <a href="#SEC39">More Examples</a>
for command-line parameter, environment variable,
and specific examples.  Readers wanting to use the self-configuration tools
or to deploy Harpoon in large testbeds should read the whole manual.

</p><a name="IDX2"></a>
<hr size="6">
<a name="NOD3"></a>
<a name="SEC2"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#SEC1" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC3" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC1" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC1" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#SEC5" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#SEC48" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h2 class="section"> 1.1 Architecture of Harpoon </h2>

<p>The design objectives of Harpoon are <em>(1)</em> to scalably generate
application-independent network traffic at the IP flow level, and
<em>(2)</em> to be easily parameterized to create traffic that is
statistically identical to traffic measured at a given vantage point
in the Internet.  
Figure 1.1 @ref{dflow,,[High-level data flow diagram of Harpoon]} 
depicts a high-level process 
flow of these objectives.  We start with the basic definition of an IP flow
and use this to create a constructive model for network traffic
generation which we describe below.

</p><table class="cartouche" border="1"><tr><td>
<a name="IDX3"></a>
<a name="IDX4"></a>
<p>@float Figure,dflow
</p><p align="center"> <img src="./net_arch.png" alt="net_arch">
</p><p>@caption{<strong>High-level data flow diagram of Harpoon.</strong>
IP flow records are collected at a given vantage point in an
operational network using standard software like <tt>flow-tools</tt>.
Key aspects of the live flows are extracted during a
self-configuration step.  These parameters are used to generate
traffic in a testbed that statistically matches the temporal (diurnal)
volume characteristics as well as the spatial (source and destination
IP address frequency) characteristics of the live flows.}
@end float</p></td></tr></table>

<p>An IP flow is typically defined as a unidirectional series of IP packets
of a given protocol traveling between a source and a destination
IP/port pair within a certain period of time.  The final condition of
this statement is somewhat ambiguous, so we pragmatically tie our
definition to Cisco's implementation of Netflow and to the tools 
we use to gather and analyze network flow data.  Netflow data includes 
source and destination
AS/IP/port pairs, packet and byte counts, flow start and end times,
protocol information, and a bitwise <tt>OR</tt> of TCP flags for all
packets of a flow, in addition to other fields.  This data is exported
either on timer deadlines or when certain events occur (e.g., a TCP
FIN or RST, or a cache becomes full), whichever comes first.  While
this would seem to pragmatically resolve ambiguity in the definition
of a flow, specific expiration-related timing behaviors can vary
(see <cite>Cisco Netflow White Paper</cite><a name="DOCF1" href="#FOOT1">(1)</a>).
The result is that flow start time stamps are accurate, while
flow end time stamps are not.  This inaccuracy does not impact a user
of Harpoon, but it does make a difference to the self-configuration
tools.  For more details, see the Harpoon technical paper.

</p><p>From this operational definition of a flow, Harpoon's architecture
begins with the notion of unicast file transfers using either TCP or
UDP.  Harpoon does not address the packet level dynamics of TCP file
transfers.  Rather, it relies on the version(s) of TCP running on end
hosts to transfer the requested file.  Modeling UDP traffic is
complicated by the fact that packet emission behaviors are largely
application-specific.  At present, Harpoon contains three models of
UDP packet transfer: a simple parameterized constant packet rate,
a fixed-interval periodic ping-pong, and an exponentially distributed
ping-pong.  The first source type is similar to some audio and video
streams, while the latter two types are intended to mimic the standard
Network Time Protocol (NTP) and Domain Name Service (DNS),
respectively.  UDP traffic in today's Internet is likely to be made up
of a wider variety of application level traffic (including voice, SQL
worms, etc.) whose behavior is not captured in our current three
source-type model.  Development of a model with a more diverse set of
UDP traffic sources is left for future work.

</p><p>The Harpoon flow model is a two level architecture and is depicted in
Figure 1.2 
@ref{arch,,[Harpoon's flow-based two level hierarchical traffic model]}.  We refer to the lower level of the Harpoon 
model as the <em>connection level</em>.  It is made up of two components that
have measurable distributional properties.  The first component is the
<em>size</em> of the file transferred, and the second component is the
time interval between consecutive file transfer requests, the
<em>inter-connection time</em>.  Harpoon makes requests for files with
sizes drawn from an empirical distribution <em>P_{FileSize</em>.
Connection initiations are separated by time intervals drawn from an
empirical distribution <em>P_{InterConnection</em>.

</p><p>The upper level of the Harpoon model is referred to as the
<em>session level</em>.  Harpoon sessions are divided into either
TCP or UDP types that conduct data transfers using the respective
protocol during the time that they are active.  The session level has
two components: the number of <em>active sessions</em> and the <em>IP
spatial distribution</em>.  By modulating the number of sessions that are
active at any point in time, Harpoon can match the byte, packet, and
flow volumes from the original data and realize the temporal (diurnal)
traffic volumes that are a common characteristic of the
Internet<a name="DOCF2" href="#FOOT2">(2)</a>.  The
average number of sessions of each type (TCP/UDP) that are active at
any point in a day is derived from a flow data time series for
consecutive non-overlapping intervals of length
<em>IntervalDuration</em> seconds to create an empirical model for
<em>P_{ActiveSessions</em>.  Scalability is naturally achieved by
dividing the number of active sessions across any number of hosts
comprising the testbed.  For each session, Harpoon picks source and
destination addresses from ranges of available addresses to make a
series of file transfer requests.  The address selection is made
preferentially using weights drawn from empirical distributions
<em>P_{IPRange_{src</em> and <em>P_{IPRange_{dest</em>.  A series of
file transfer requests then takes place between the source and
destination for <em>IntervalDuration</em> seconds.  When Harpoon is
started, it begins with the average number of sessions in the first
interval and proceeds through consecutive intervals for the duration
of the test.

</p><p>In summary, the Harpoon model is made up of a combination of five
distributional models for TCP sessions: file size, inter-connection
time, source and destination IP ranges, number of active sessions.  There
are three distributional models for UDP sessions: constant bit-rate,
periodic and exponential ping-pong.  Each of these distributions can
be specified manually or, in the case of TCP traffic, extracted from 
packet traces or Netflow data collected at a live router.  These models 
enable the workload generated by Harpoon to be application independent 
or to be tuned to a specific application.  The models are combined in 
a constructive manner to create a series of file transfer requests that 
results in representative flow-level network traffic.
The parameters for TCP sessions are summarized below:

</p><a name="IDX5"></a>
<a name="IDX6"></a>
<dl compact="compact">
<dt> <strong>Parameter</strong></dt>
<dd><p><strong>Description</strong>

</p><a name="IDX7"></a>
</dd>
<dt> <em>P_{FileSize</em></dt>
<dd><p>Empirical distribution of file sizes transferred.

</p><a name="IDX8"></a>
</dd>
<dt> <em>P_{InterConnection</em></dt>
<dd><p>Empirical distribution of time between consecutive TCP connections initiated 
by an IP source-destination pair. 

</p><a name="IDX9"></a>
</dd>
<dt> <em>P_{IPRange_{src</em> and <em>P_{IPRange_{dest</em></dt>
<dd><p>Ranges of IP addresses with preferential weights set to match the 
empirical frequency distributions from the original data.

</p><a name="IDX10"></a>
</dd>
<dt> <em>P_{ActiveSessions</em></dt>
<dd><p>The distribution of the average number of sessions (IP source-destination 
pairs) active during consecutive intervals of the measured data.  By 
modulating this distribution, Harpoon can match the temporal byte, 
packet and flow volumes from the original data. 

</p><a name="IDX11"></a>
</dd>
<dt> IntervalDuration</dt>
<dd><p>Time granularity over which Harpoon matches average byte, packet and 
flow volumes
</p></dd>
</dl>

<table class="cartouche" border="1"><tr><td>
<a name="IDX12"></a>
<a name="IDX13"></a>
<p><a name="ANC1"></a>
@float Figure,arch
</p><p align="center"> <img src="./harpoon_terms.png" alt="harpoon_terms">
</p><p>@caption{<strong>Harpoon's flow-based two level hierarchical traffic
model.</strong>  Sessions are comprised of a series of connections separated
by durations drawn from the inter-connection time distribution.
Source and destination IP address selection (A and B in the figure) is
weighted to match the frequency distribution of the original flow
data.  The number of active sessions determines the overall average
load offered by Harpoon.  A heavy-tailed empirical file size
distribution and an ON/OFF transfer model generate self-similar
packet-level behavior.}
@end float</p></td></tr></table>

<a name="IDX14"></a>
<a name="IDX15"></a>
<hr size="6">
<a name="NOD4"></a>
<a name="SEC3"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#SEC2" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC4" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC1" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC1" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#SEC5" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#SEC48" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h2 class="section"> 1.2 Harpoon Software Components </h2>

<p>There are five programs and scripts included with Harpoon:

</p><ul class="toc">
<li><p> <code>harpoon</code>, the main executable, along with 
<em>traffic generation plugins</em> for implementing Harpoon
user-level behavior using OS-supplied protocol implementations
(e.g. TCP) or another kind of packet emission processes,

</p></li><li><p> <code>config_validator</code>, a utility for validating the
structure of a config file.

</p></li><li><p> <code>harpoon_flowproc</code>, a utility for pre-processing flow
records (raw Netflow version 5 or <code>flow-tools</code> format) for
self-configuration, and

</p></li><li><p> <code>harpoon_conf.py</code>, a utility for generating
configuration files for <code>harpoon</code> (the self-configurator).

</p></li><li><p> <code>harpoon_reconf.py</code>, a utility for tuning existing configuration
files to produce desired traffic volumes.
</p></li></ul>

<p><code>harpoon</code>, <code>config_validator</code>, and <code>harpoon_flowproc</code>
are C++ programs.  Requirements for building Harpoon include a C++ compiler 
with a functional standard template library (recent versions of GCC easily 
satisfy this requirement), a POSIX threads implementation, and the 
eXpat XML parsing library<a name="DOCF3" href="#FOOT3">(3)</a>.
The <tt>flow-tools</tt><a name="DOCF4" href="#FOOT4">(4)</a> 
library is optionally used by <code>harpoon_flowproc</code>.  If no installation 
of <tt>flow-tools</tt> is found, the <code>harpoon_flowproc</code> tool will still
be built, but will only be able to process wire format Netflow 5 records.

</p><p>The scripts <code>harpoon_conf.py</code> and <code>harpoon_reconf.py</code> require
a Python interpreter, version 2.3 or 
greater<a name="DOCF5" href="#FOOT5">(5)</a>.  If a suitable Python
interpreter is not found, the other tools will be built, but a warning
will appear when configuring the software.

</p><a name="IDX16"></a>
<a name="IDX17"></a>
<p>The traffic generation plugins exist as dynamically loadable modules
(aka shared libraries, dynamically linked libraries, bundles).  For
example, all logic specific to generating TCP flow traffic is confined
to the <code>TCPPlugin</code> module and all logic specific for UDP
constant bit-rate traffic generation is confined to the
<code>UDPcbrPlugin</code> module.  (<a href="#SEC46">Creating New Traffic Generation Modules</a> describes how to create modules to generate any type of
desired traffic.)  You do not have to know how these modules work to
generate basic TCP or UDP-CBR traffic, but you should understand the
basic roles of the distributions used by different Harpoon plugins
in order to feed properly formatted configuration files to Harpoon.

</p><p>Subsequent chapters describe how to use these tools to produce desired
traffic.  For basic configuration using sample configuration files supplied
with the Harpoon software distribution, see <a href="#SEC5">Basic Configuration</a>.  For
more extensive discussion of configuring Harpoon using the self-configuration
tools, see <a href="#SEC10">Advanced Configuration</a>.  Command-line options, applicable
environment variables, and signal handling for the above tools are covered
in <a href="#SEC21">Running Harpoon</a>.  Finally, more examples on configuring, using,
and managing Harpoon are given in <a href="#SEC39">More Examples</a>.  Note that this manual
assumes a working knowledge of UNIX-ish systems and shell commands.  If
you need help on those basics, look elsewhere.

</p><a name="IDX18"></a>
<a name="IDX19"></a>
<hr size="6">
<a name="NOD5"></a>
<a name="SEC4"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#SEC3" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC5" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC1" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC3" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#SEC5" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#SEC48" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h3 class="subsection"> 1.2.1 Building the Harpoon Software </h3>

<p>Building Harpoon consists of the following steps:

</p><ol>
<li><p> Unpack the distribution.  Using GNU <code>tar</code>, 
&quot;<code>tar xzvf harpoon_distribution.tgz</code>&quot; will do the trick, substituting
the particular file name for &quot;<code>harpoon_distribution.tgz</code>&quot;.

</p></li><li><p> Run <code>./configure</code> in the top-level directory of the unpacked 
software.  This step will build appropriate make files for your system.  
Optionally, you may use the <tt>-prefix</tt> flag to specify where the software
is to be installed.  The installation location defaults to 
<tt>/usr/local/harpoon</tt>.

</p></li><li><p> Run <code>make</code>.  By default, the main components of Harpoon, all 
plugins, and some (presently undocumented) miscellaneous tools are built.  
If available, use GNU make, since some make programs do not properly handle 
some of the constructs in Harpoon's makefiles.

</p></li><li><p> (optional) <code>make selfconf</code>.  Build the self configuration tool
<code>harpoon_flowproc</code>.

</p></li><li><p> (optional) <code>make doc</code>.  You'll need the GNU texinfo tools and/or 
doxygen for this to work.

</p></li><li><p> (optional) <code>make install</code>.  Move the appropriate components
to the installation target directory.  By default, the install directory 
is <tt>/usr/local/harpoon</tt>.
</p></li></ol>

<p>Harpoon is known to build and run on FreeBSD 5.1-5.4, Linux 2.2-2.6,
MacOS X 10.2-10.4, and Solaris 8-10.  Harpoon does not build on Windows,
though there is an intent to eventually make that possible.

</p><a name="IDX20"></a>
<p>If <code>configure</code> does not find certain required libraries, you might
try the following syntax:
</p><table><tr><td>&nbsp;</td><td><pre class="example">$ CPPFLAGS=-I/path-to-include-files LDFLAGS=-L/path-to-libs \
   ./configure
</pre></td></tr></table><p>This syntax generally works to force <code>configure</code> to look in the
right directories.

</p><p>By default, harpoon is built with optimization level `<samp>-O2</samp>' and
with debugging symbols `<samp>-g</samp>'.  An easy way to change this is to use the
above syntax recipe:
</p><table><tr><td>&nbsp;</td><td><pre class="example">$ CXXFLAGS=&quot;-g&quot; ./configure
</pre></td></tr></table><p>The above example will build Harpoon with debugging symbols but no 
optimization.  Building Harpoon without debugging symbols and a desired
level of optimization can be accomplished in a similar way.

</p><p>Finally, you'll very likely have to set <tt>LD_LIBRARY_PATH</tt> (Linux, FreeBSD and 
Solaris) or <tt>DYLD_LIBRARY_PATH</tt> (MacOS X) to the directory where plugin 
objects are installed.  See section <a href="#SEC26">Environment Variables</a> for further information.

</p>



<hr size="6">
<a name="NOD6"></a>
<a name="SEC5"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#SEC4" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC6" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC1" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Top" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#SEC10" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#SEC48" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h1 class="chapter"> 2. Basic Configuration </h1>

<p>This chapter discusses simple configurations of Harpoon using the supplied
example config files (in the `<tt>examples</tt>' subdirectory of the software
distribution).  Simple changes to the config files to accomodate local
addressing and traffic volume requirements are also discussed.  The next
chapter discusses more complicated configurations of Harpoon using your 
own flow records.  It is assumed here that you have successfully built Harpoon 
(See section <a href="#SEC4">Building the Harpoon Software</a>).

</p><p>Example configurations are found in the `<tt>examples</tt>' subdirectory.
There are two TCP traffic configuration examples provided:

</p><a name="IDX21"></a>
<dl compact="compact">
<dt> `<tt>tcp_client.xml</tt>' and `<tt>tcp_server.xml</tt>'</dt>
<dd><p>A very simple setup for illustrative purposes only.

</p></dd>
<dt> `<tt>tcp_client_ex2.xml</tt>' and `<tt>tcp_server_ex2.xml</tt>'</dt>
<dd><p>A TCP client/server pair with inter-connection times generated from 
exponential distribution with mean 1 second and file sizes generated from 
Pareto distribution with alpha=1.2 shape=1500 (bytes).
</p></dd>
</dl>


<a name="IDX22"></a>
<a name="IDX23"></a>
<hr size="6">
<a name="NOD7"></a>
<a name="SEC6"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#SEC5" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC7" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC5" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC5" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#SEC10" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#SEC48" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h2 class="section"> 2.1 Validating a Configuration </h2>

<p>The first step toward running <code>harpoon</code> should be to make sure
configuration files you intend to use are properly formed.  A tool,
<code>config_validator</code> exists for this purpose.  The tool takes only
one argument, the configuration file.  Shown below is output of 
<code>config_validator</code> run on `<tt>tcp_client_ex2.xml</tt>' and 
`<tt>tcp_server_ex2.xml</tt>'.

</p><table><tr><td>&nbsp;</td><td><pre class="smallexample">$ ./config_validator ../examples/tcp_client_ex2.xml
loading ../examples/tcp_client_ex2.xml
bad address - no prefix len?
Checking load of TcpClient
name: TcpClient
objfile: tcp_plugin.dylib
maxthreads: 10
personality: client
client source pool:
address list:
        0.0.0.0 - 0.0.0.0 :0 (1)
client destination pool: 
address list:
        127.0.0.1 - 127.0.0.1 :10000 (1)

dumping distributions (first 10): 
active_sessions: 10 
interconnection_times: 3.99391 0.293601 2.12709 1.21451 0.409159 0.1121 
0.580837 0.101379 0.724933 0.224031 
</pre></td></tr></table>
<a name="IDX24"></a>
<p>There are a number of items to note here:
</p><ul class="toc">
<li><p> First, each plugin configuration has a name.  The name of this plugin
is TcpClient.  The name must be unique for all plugins loaded and running
in the same Harpoon process.  (Note that you can have multiple configurations
of TCP plugins running as both clients and servers within a single process,
but they must each have different names.)

</p></li><li><p> The shared object file loaded for this plugin is `<tt>tcp_plugin.dylib</tt>'.
The operating system loader finds this file by searching the directories
specified by <code>LD_LIBRARY_PATH</code> environment variable.  
See section <a href="#SEC26">Environment Variables</a> for more information.

</p></li><li><p> In Harpoon, sessions are mapped in a 1-1 fashion onto threads.  The
<code>maxthreads</code> plugin attribute specifies the maximum number of operating
system threads to start in the plugin.  To generate a specific level of 
traffic, a certain number of threads/sessions are made active over successive
intervals of time.  This number of active sessions is specified by the
<code>active_sessions</code> distribution.  Note that a specified number of active
sessions can be greater than the value given for <code>maxthreads</code>.  In this
case, the <code>maxthreads</code> parameter acts as a limit; the actual number of
active sessions is <em>min(<code>maxthreads</code>,ActiveSessions_i)</em>, 
where <em>ActiveSessions_i</em> is the number of active sessions for 
interval <em>i</em>.
See <a href="#ANC1">distributional parameters</a> to review the role of sessions in Harpoon.

</p></li><li><p> <code>personality</code> specifies whether this plugin is acting in a
server-side or client-side role. 

</p></li><li><p> <code>client source pool</code> and <code>client destination pool</code> denote
address pools used by this plugin.  Since this is a client-side plugin,
the <code>client source pool</code> is used to bind the local-side of TCP connections
to a specific local address.  In this example, the local address is 
<code>0.0.0.0</code>, meaning that the operating system will fill in a default 
local address.  The <code>client destination pool</code> addresses specify remote
addresses and ports where Harpoon TCP servers are listening.  

</p></li><li><p> Finally, 10 random values from the distributions used by the particular
endpoint (client or server) are printed.  For TCP clients, there are
two relevant distributions: <code>active_sessions</code> and 
<code>interconnection_times</code>.
For TCP servers (example shown below), there are two relevant distributions:
<tt>active_sessions</tt> and <tt>file_sizes</tt>.
</p></li></ul>

<p>Validation of the server-side configuration file is now shown below:

</p><table><tr><td>&nbsp;</td><td><pre class="smallexample">$ ./config_validator ../examples/tcp_server_ex2.xml
loading ../examples/tcp_server_ex2.xml
bad address - no prefix len?
Checking load of TcpServer
name: TcpServer
objfile: tcp_plugin.dylib
maxthreads: 37
personality: server
server address pool:
address list:
        0.0.0.0 - 0.0.0.0 :10000 (1)

dumping distributions (first 10): 
active_sessions: 37 
file_sizes: 18643900 15150 807481 157679 23465 4930 39188 4418 56341 10863 
</pre></td></tr></table>
<p>Now that the client-side configuration file has been validated and explained,
there is little new to describe.  Note that the name of the plugin has
changed to <code>TcpServer</code> and the personality is <code>server</code>, but the 
plugin shared object file is still <code>tcp_plugin.dylib</code>.  For servers,
the <code>maxthreads</code> and <code>active_sessions</code> parameters specify the 
number of active threads waiting to service file requests.  These numbers
can be set to the same single value in most cases.  (The problem of how many
threads/sessions to keep active is similar to the problem of configuring
a web server.  Unlike modern web servers, Harpoon does not allocate server 
threads in a dynamic way, so this number must be statically set in the 
configuration files to a reasonable value.)  Finally, note that the server
address is set to a default address (<code>0.0.0.0</code>) and the port is
set to 10000.

</p><a name="IDX25"></a>
<a name="IDX26"></a>
<hr size="6">
<a name="NOD8"></a>
<a name="SEC7"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#SEC6" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC8" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC5" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC5" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#SEC10" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#SEC48" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h2 class="section"> 2.2 Modifying Configuration File Addresses </h2>

<p>For the client-side configuration file shown above, the destination address
pool is set to a single address of <code>127.0.0.1</code> - the loopback 
interface.  This isn't particularly helpful, since we would like to generate
traffic over a network, not just through some operating system layers.
This address pool is easily changed.

</p><p>Using your favorite text editor, open the file `<tt>tcp_client_ex2.xml</tt>'.
Toward the end of the file the following lines are found:

</p><table><tr><td>&nbsp;</td><td><pre class="smallexample">       ...
       &lt;address_pool name=&quot;client_source_pool&quot;&gt;
            &lt;address ipv4=&quot;0.0.0.0&quot; port=&quot;0&quot; /&gt;
       &lt;/address_pool&gt;

       &lt;address_pool name=&quot;client_destination_pool&quot;&gt;
            &lt;address ipv4=&quot;127.0.0.1/32&quot; port=&quot;10000&quot; /&gt;
       &lt;/address_pool&gt;
       ...
</pre></td></tr></table>
<p>To change the server address (<code>client_destination_pool</code>), change
the address block <code>127.0.0.1/32</code> to be the desired address.  For
host prefixes (/32 masks) the mask is optional; specifying <code>127.0.0.1</code>
has the same effect as specifying <code>127.0.0.1/32</code>.  
(<code>config_validator</code> warns about this lack of prefix, however.  See
the above examples for the warning: &quot;bad address - no prefix len?&quot;.)

</p><p>If there are two servers running on separate machines and without contiguous
addresses, simply add another <code>&lt;address ... /&gt;</code> line with the second
address.

</p><p>Note that for servers, the address pool definition follows the same structure, 
but there is a current limitation in that only one address is used for
binding.  That is, specifying two addresses for a server to listen on will
not have the desired effect; only one address will be used.  For now, using
the default address specifier, <code>0.0.0.0</code>, is the best option.

</p><a name="IDX27"></a>
<hr size="6">
<a name="NOD9"></a>
<a name="SEC8"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#SEC7" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC9" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC5" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC5" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#SEC10" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#SEC48" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h2 class="section"> 2.3 Starting Harpoon </h2>

<p>We now have two configuration files with addresses set appropriately.  The
examples below show how to start harpoon with these configuration files. 
We assume here that the environment variable <code>LD_LIBRARY_PATH</code> has 
been set properly (see section <a href="#SEC26">Environment Variables</a>).  Alternatively, a
shell script <code>run_harpoon.sh</code> is installed when <code>make install</code>
is run that sets the environment variable to the correct directory and
then executes <code>harpoon</code>.  The examples below use this script, which
has been installed in the default location of `<tt>/usr/local/harpoon</tt>'.

</p><p>On the server machine:
</p><table><tr><td>&nbsp;</td><td><pre class="smallexample">$ /usr/local/harpoon/run_harpoon.sh -v10 -w300 -c \
  -f examples/tcp_server.xml
...
10:02:16 sev(07) stopping plugin TcpServer
10:02:16 sev(00) TcpServer: plugin stopped - threads killed and reaped
10:02:16 sev(07) starting plugin TcpServer
10:02:16 sev(02) TcpServer: no plugin state existed on start - created
10:02:16 sev(01) TcpServer: started plugin with 1 threads.
10:02:16 sev(01) &lt;stopping plugins: TcpServer:ok &gt;&lt;starting plugins: \ 
  TcpServer:ok &gt;
10:02:16 sev(09) harpoon started. verbosity&lt;10&gt;warp_factor&lt;60&gt; \ 
  autoincr?&lt;1&gt;continuousrun?&lt;1&gt;
10:02:16 sev(05) 00:00 - emulation time tick
...
</pre></td></tr></table>
<p>And on the client machine:
</p><table><tr><td>&nbsp;</td><td><pre class="smallexample">$/usr/local/harpoon/run_harpoon.sh -v10 -w300 -f examples/tcp_client.xml 
...
10:02:40 sev(07) stopping plugin TcpClient
10:02:40 sev(00) TcpClient: plugin stopped - threads killed and reaped
10:02:40 sev(07) starting plugin TcpClient
10:02:40 sev(02) TcpClient: no plugin state existed on start - created
10:02:40 sev(01) TcpClient: started plugin with 1 threads.
10:02:40 sev(01) &lt;stopping plugins: TcpClient:ok &gt;&lt;starting plugins: \ 
  TcpClient:ok &gt;
10:02:40 sev(09) harpoon started. verbosity&lt;10&gt;warp_factor&lt;300&gt;\ 
  autoincr?&lt;1&gt;continuousrun?&lt;0&gt;
10:02:40 sev(05) 00:00 - emulation time tick
...
</pre></td></tr></table>
<a name="IDX28"></a>
<p>The command-line options used above require explanation:
</p><dl compact="compact">
<dt>`<samp> -v10 </samp>'</dt>
<dd><p>Turn on verbose messages.  You should use this setting (level 10) of
verbosity, especially when first getting started with Harpoon.

</p></dd>
<dt>`<samp> -w300</samp>'</dt>
<dd><p>Set interval duration length to 300 seconds (also referred to as 
&quot;warp factor&quot;).  Given a specification of <code>&lt;active_sessions&gt;</code> in
a configuration file, Harpoon will iterate through this list,
setting the number of active sessions to each value for durations of 
300 seconds.  If the original intervals were one hour in length (<em>i.e.</em>,
the average number of sessions was calculated over successive intervals
of one hour) and the `<samp>-w</samp>' flag is set to 600 seconds, a 24 hour 
period could be emulated in 14,400 seconds (four hours).  It should
be clear from this explanation where the term &quot;warp factor&quot; comes from.

</p></dd>
<dt>`<samp> -f [examples/tcp_client.xml, examples/tcp_server.xml]</samp>'</dt>
<dd><p>Specify the configuration file to load.  Multiple `<samp>-f</samp>' flags
may be used to tell Harpoon to load more than one configuration file.

</p></dd>
<dt>`<samp> -c</samp>'</dt>
<dd><p>While the first three options were used for each side (client and server)
of Harpoon, the `<samp>-c</samp>' parameter is only used for the server-side.
This option tells Harpoon to continuously cycle over its list of
active sessions, specified in <code>&lt;active_sessions&gt;</code>.  Normally, Harpoon
will iterate only <strong>once</strong> through this list, then cease activity.
For experiments of fixed duration, this is often the desired behavior.
However, for servers this behavior is generally to be avoided.  The reason
is that servers (at least for the plugins provided with the Harpoon software
distribution) do not produce traffic without some request or provocation
from clients.  It is therefore much easier to simply leave servers running,
cycling over a list of active sessions (typically set to a single value
anyway), much like a continuously running web server.
</p></dd>
</dl>

<p>More information on command-line parameters is given in 
<a href="#ANC3">harpoon command-line parameters</a>.

</p><p>Now that the client and server are started, we can get information from
these processes via XML-RPC.  Using the <code>stats.py</code> script in the
`<tt>cli</tt>' subdirectory (and a Python interpreter of version 2.2 or greater):

</p><a name="IDX29"></a>
<table><tr><td>&nbsp;</td><td><pre class="smallexample">$ python ./stats.py -u http://servermachine:8180/ \ 
  -u http://clientmachine:8180/
stats for  &lt;ServerProxy for servermachine:8180/&gt;
server-wide information:
        emulation_interval   1
----
plugin-specific information:

        TcpServer is running - up for  81  seconds
                target threads = 1  active threads = 1
                num_transfer = 36
                send_bandwidth_total_bps = 35555.6
                send_bandwidth_recent_bps = 35555.6
                bytes_sent_total = 360000.0
                bytes_sent_recent = 360000.0
                personality = server
stats for  &lt;ServerProxy for clientmachine:8180/&gt;

server-wide information:
        emulation_interval   0
----
plugin-specific information:

        TcpClient is running - up for  21  seconds
                target threads = 1  active threads = 1
                num_requests = 10
                personality = client
</pre></td></tr></table>
<p>Note that the statistics gathered using the <code>stats.py</code> tool are
approximate and only reflect an application point of view.
You should not use them in any &quot;real&quot; measurements (like for
paper submissions!).  They are there to simply help with diagnosing and 
monitoring currently running 
Harpoon processes.  Other XML-RPC tools are provided in the `<tt>cli</tt>' 
subdirectory.  More information on them is provided in <a href="#SEC32">Managing harpoon</a>.

</p>
<a name="IDX30"></a>
<a name="IDX31"></a>
<hr size="6">
<a name="NOD10"></a>
<a name="SEC9"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#SEC8" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC10" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC5" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC5" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#SEC10" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#SEC48" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h2 class="section"> 2.4 Modifying a Configuration to Produce Different Traffic Volumes </h2>

<p>A common requirement is for harpoon to generate a specific average load.  
A tool, <code>harpoon_reconf.py</code> is provided to assist in determining the
appropriate number of sessions to configure at a client to produce the
desired level of traffic.

</p><p>If we wish to set the number of sessions so that the traffic rate (bandwidth) 
produced by Harpoon is 5 Mbps averaged over a 10 minute interval, we can use 
the <code>harpoon_reconf.py</code> tool as follows 
(from the top-level Harpoon source directory):

</p><table><tr><td>&nbsp;</td><td><pre class="smallexample">$ python selfconf/harpoon_reconf.py -d -c examples/tcp_client_ex2.xml 
  -s examples/tcp_server_ex2.xml -i 600 -r 5000000
...
targetbytes 375000000.0 simbytes 378522468 median 4 mean 3 \ 
  stdev 0.771722460186 max 5 flows 4085
number of sessions should be 3 to achieve volume of  375000000 bytes \ 
  (5000000.0 bits/sec)
$
</pre></td></tr></table>
<p>The tool reports that the number of active sessions should be set to 3 (the
mean).

</p><p>The options used for <code>harpoon_reconf.py</code> are as follows:
</p><dl compact="compact">
<dt>`<samp> -d</samp>'</dt>
<dd><p>Turn on verbose (debugging) information.

</p></dd>
<dt>`<samp> -c examples/tcp_client_ex2.xml</samp>'</dt>
<dd><p>Specify the client-side configuration file.  This is a required parameter.

</p></dd>
<dt>`<samp> -s examples/tcp_server_ex2.xml</samp>'</dt>
<dd><p>Specify the server-side configuration file.  This is a required parameter.

</p></dd>
<dt>`<samp> -i 600</samp>'</dt>
<dd><p>Specify the interval duration.  The value used for this parameter should be
the same as the `<samp>-w</samp>' parameter passed to <code>harpoon</code>.  
See <a href="#ANC3">harpoon command-line parameters</a> and <a href="#SEC8">Starting Harpoon</a> for more
information.  This is a required parameter.

</p></dd>
<dt>`<samp> -r 5000000</samp>'</dt>
<dd><p>Specify the target traffic rate, in bits per second.  Alternatively, you
may use the `<samp>-b</samp>' parameter to specify the total volume (in bytes)
that should be generated over the specified interval duration (given by
`<samp>-i</samp>').  One of `<samp>-r</samp>' or `<samp>-b</samp>' is required.
</p></dd>
</dl>

<p>Note that the `<samp>-d</samp>' flag was used, producing verbose output.  The
target byte volume to produce over the requested interval of 600 seconds
is 375000000 (<em>5000000 / 8 \times 600 = 375000000</em>).  
The mean and standard deviation of the sessions needed to produce 5 Mbps
are 3 and 0.772, respectively.  The output value <code>simbytes</code> is the average
amount of traffic (in bytes) estimated to be produced for three sessions.
This value will always be greater than the target (but generally not
too much), since the self configuration tools aim to produce at least as much 
traffic as was originally sent.

</p><a name="IDX32"></a>
<a name="IDX33"></a>
<p><a name="ANC2"></a>
After restarting the server and client, we use <code>stats.py</code> one 
minute later to check the server status and see that Harpoon is producing 
roughly 5Mbps.  This tool takes only one option, `<samp>-u</samp>', to specify
the URL of the harpoon XML-RPC listener.  By default, port 8180 is used.

</p><table><tr><td>&nbsp;</td><td><pre class="smallexample">$ python cli/stats.py -u http://servermachine:8180/
...
        TcpServer is running - up for  60  seconds
                target threads = 3  active threads = 3
                num_transfer = 397
                send_bandwidth_total_bps = 4334040.0
                send_bandwidth_recent_bps = 6360550.0
                bytes_sent_total = 32505300.0
                bytes_sent_recent = 13516200.0
                personality = server
...
</pre></td></tr></table>
<p>Near the end of the test, we run <code>stats.py</code> again to check progress:

</p><table><tr><td>&nbsp;</td><td><pre class="smallexample">$ python cli/stats.py -u http://servermachine:8180/
...
        TcpServer is running - up for  557  seconds
                target threads = 3  active threads = 3
                num_transfer = 4217
                send_bandwidth_total_bps = 6247000.0
                send_bandwidth_recent_bps = 5237350.0
                bytes_sent_total = 434947000.0
                bytes_sent_recent = 75286800.0
                personality = server
...
</pre></td></tr></table>
<p>We see that Harpoon is making a pretty good match to 5 Mbps and is quite
close to the average <code>match_rate</code> calculated above.

</p><p>Recall that the matching is done based on some interval of time 
(@pxref{arch,,[Harpoon's flow-based two level hierarchical traffic model]}).
Note also that this matching is approximate, and depends on many factors.  The
nature of the underlying distributions (file sizes and interconnection times)
have a great impact on the goodness of the match, but selection of the 
interval duration also has a significant effect.  Generally, longer intervals
(<em>i.e.</em> five or ten minutes) are best.  Very often the match between 
what you expect and what you get is quite good, but it can be &quot;less good&quot;
if you pick a short interval and have distributions with extreme variability.

</p>




<a name="IDX34"></a>
<a name="IDX35"></a>
<hr size="6">
<a name="NOD11"></a>
<a name="SEC10"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#SEC9" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC11" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC5" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Top" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#SEC21" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#SEC48" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h1 class="chapter"> 3. Advanced Configuration </h1>

<p>In the previous chapter, basic configuration of Harpoon was discussed,
including configuration file validation, setting desired endpoint addresses,
and tuning Harpoon to produce the desired traffic volume.  This chapter
fills in gaps from the previous chapter by discussing, in more detail,
the structure of Harpoon configuration files (using the TCP traffic
generator plugins as the basis for discussion), and the use of 
the self-configuration tools.

</p><p>Harpoon uses XML documents for its config files.  As described in
<a href="#ANC4">validation of config files</a>, an XML schema 
is distributed with Harpoon that defines the structure of config files
for the supplied TCP traffic plugin.
Tools are provided to automatically generate configuration files from raw
flow records.  There is also a tool,
<code>config_validator</code>, which is a simple validator of config files.
The validator can't catch all logical errors, but it will catch all 
syntactical errors.

</p><p>While the self-configuration tool <code>harpoon_conf.py</code> can generate valid 
config files for Harpoon, it is often useful to manually tweak the files 
produced by this script depending on testbed requirements.  For this reason,
description of how to use the self-configuration tools is followed by
a discussion of the detailed structure of configuration files.

</p><a name="IDX36"></a>
<a name="IDX37"></a>
<hr size="6">
<a name="NOD12"></a>
<a name="SEC11"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#SEC10" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC12" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC10" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC10" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#SEC21" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#SEC48" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h2 class="section"> 3.1 Self-Configuration Tools </h2>

<p>For self-configuration, there are two required steps, and one optional step.
</p><ol>
<li><p> Process flow records using the <code>harpoon_flowproc</code> tool. 
The flow records can be in Netflow version 5 wire format or in
 <code>flow-tools</code> format.  The output of this step is an intermediate flow 
representation.
</p></li><li><p> Process the intermediate format produced in the previous step using
the <code>harpoon_conf.py</code> tool to produce Harpoon config files.
</p></li><li><p> Optionally, the configuration files produced in step 2 can be
processed to produce a bit rate different from the original flow trace.
The <code>harpoon_reconf.py</code> tool takes two Harpoon configuration files
as input to perform this task.
</p></li></ol>

<hr size="6">
<a name="NOD13"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#SEC11" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC13" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC10" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC10" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#SEC21" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#SEC48" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="SEC12"></a>
<h2 class="section"> 3.2 The <code>harpoon_flowproc</code> tool </h2>

<p>The <code>harpoon_flowproc</code> tool takes raw flow records in either
Netflow version 5 wire format, or in <code>flow-tools</code> format.  If
your system does not have <code>flow-tools</code> installed, you'll only
be able to use the raw Netflow capability.  The tool takes the flow
records as standard input and produces an intermediate format on standard
output.  This intermediate format is used by the tool 
<code>harpoon_conf.py</code> (see section <a href="#SEC13">The <code>harpoon_conf.py</code> tool</a>, below) to
produce configuration files for Harpoon.

</p><p>By default, <code>harpoon_flowproc</code> uses an <em>IntervalDuration</em> value
of 60 seconds, expects TCP flags in the flow records, and expects the input
format to be <code>flow-tools</code>.  See <a href="#SEC29"><code>harpoon_flowproc</code></a> for
more information on command line options.  The example below shows
an hour's worth of flow records being piped into <code>harpoon_flowproc</code>,
with the output written to `<tt>flowproc.out</tt>'.  It shows that there
were over 4 million flows over that hour, with about 1.8 million TCP flows.
However, only 1.2 million TCP flows had SYN and FIN or RST flags (i.e.,
were &quot;well-formed&quot;).  Finally, flow surgery did not have to be performed
on any of the flows.  (Note that it isn't abnormal that surgery is minimal
or not required, at least on flow record traces I've looked at.)

</p><table><tr><td>&nbsp;</td><td><pre class="smallexample">$ flow-cat ft-v05.2002-07-31.13* | ./harpoon_flowproc -i 60 &gt; flowproc.out
sorting tcp flow records...  took 25 sec.
total flows: 4071060
total TCP flows: 1867860
total well-formed TCP flows: 1216691
surgery performed: 0
$
</pre></td></tr></table>
<hr size="6">
<a name="NOD14"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#SEC12" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC14" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC10" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC10" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#SEC21" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#SEC48" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="SEC13"></a>
<h2 class="section"> 3.3 The <code>harpoon_conf.py</code> tool </h2>

<p>The Python script <code>harpoon_conf.py</code> uses the output from the tool
<code>harpoon_conf</code> to produce configuration files for Harpoon.
In the example below, an interval duration of 600 seconds is specified 
(`<samp>-i</samp>' 600), source and destination address pools are specified
(`<samp>-S</samp>' and `<samp>-D</samp>' options), and output config files have
a prefix of &quot;testoutput&quot;.  See <a href="#SEC30"><code>harpoon_conf.py</code></a> for
more information on command line parameters.

</p><table><tr><td>&nbsp;</td><td><pre class="smallexample">$ ./harpoon_conf.py -i 600 -S '10.54.1.0/24' -D '10.54.42.1/32' \ 
  -p testoutput flowproc.out 
got starting time from file header:  1028138318.2
progress (10k lines):  . . . . . . . . . .   100000
. . . . . . . . . . .   200000
. . . . done ( 232645 lines)
$
</pre></td></tr></table>
<p>The configuration files resulting from this script may still need to be
tweaked.  In particular, the number of active sessions set in the client
configuration file may exceed the maximum number of threads per
process on the operating system where Harpoon will be run.  Either that,
or you may wish to set up a multi-host configuration, splitting the load
generation over some number of machines.  For these situations, you will
have to manually edit the configuration files, changing the number of
active sessions to an appropriate value, and setting client source
and destination addresses to appropriate values.

</p>
<hr size="6">
<a name="NOD15"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#SEC13" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC15" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC10" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC10" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#SEC21" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#SEC48" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="SEC14"></a>
<h2 class="section"> 3.4 The <code>harpoon_reconf.py</code> tool </h2>

<p>The <code>harpoon_reconf.py</code> is used to tune existing client and
server configuration files to produce a specified bit rate.  The configuration
files that this script uses can be produced by the <code>harpoon_conf.py</code>
tool or can be made using configuration files based on distributions from 
known distributions.  In the example below, the target rate is specified
as 5 Mbps and the script reports that 314 sessions should be configured
to produce this volume.  The script itself does not modify the configuration
files, so this value must be set in the client configuration file.
See also <a href="#SEC9">Modifying a Configuration to Produce Different Traffic Volumes</a>,
and <a href="#SEC31"><code>harpoon_reconf.py</code></a>.

</p><table><tr><td>&nbsp;</td><td><pre class="smallexample">$ ./harpoon_reconf.py -d -c testoutput_tcpclient.xml \ 
  -s testoutput_tcpserver.xml -i 300 -r 5000000
target volume:  187500000.0
interval duration:  300
client conf file:  testoutput_tcpclient.xml
server conf file:  testoutput_tcpserver.xml
target: 187500000.0 carry: 0
targetbytes 187500000.0 simbytes 187720505 median 320 mean 314 \ 
  stdev 55.02035895 max 415 flows 16174
number of sessions should be 314 to achieve volume of  187500000 bytes \ 
  (5000000.0 bits/sec)
$
</pre></td></tr></table>

<hr size="6">
<a name="NOD16"></a>
<a name="SEC15"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#SEC14" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC16" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC10" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC10" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#SEC21" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#SEC48" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h2 class="section"> 3.5 Configuration File Structure </h2>

<p>The best way to describe the structure of Harpoon config files is
through an example:

</p><table><tr><td>&nbsp;</td><td><pre class="smallexample">&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;harpoon_plugins&gt;
        &lt;plugin name=&quot;Example&quot; objfile=&quot;example.so&quot;
                maxthreads=&quot;42&quot;, personality=&quot;server&quot;&gt;

            ... 

        &lt;/plugin&gt;
&lt;/harpoon_plugins&gt;
</pre></td></tr></table>
<p>The top-level tag in any config file must be <code>&lt;harpoon_plugins&gt;</code>.
Within that element, any number of traffic generation <code>&lt;plugin&gt;</code>s
may be defined.  Every Harpoon configuration file <strong>must</strong> be
structured this way - the XML parser that Harpoon uses (<code>expat</code>
-- <a href="http://expat.sourceforge.net/">http://expat.sourceforge.net/</a>) enforces this requirement.

</p>
<a name="IDX38"></a>
<hr size="6">
<a name="SEC16"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#SEC15" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC17" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC10" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC15" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#SEC21" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#SEC48" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h3 class="subsection"> 3.5.1 <code>&lt;plugin&gt;</code> Definitions </h3>

<p>For the <code>&lt;plugin&gt;</code> element, there are three require attributes,
and one optional attribute:

</p><dl compact="compact">
<dt><strong> name</strong></dt>
<dd><p>An identifier for this plugin.  It must be unique for all incarnations
of a traffic generator module running under the control of a single
<code>harpoon</code> executable.  That is, you must have separate
<code>&lt;plugin&gt;</code> tags defined for client and server portions of the
same traffic generator if they are running in the same
<code>harpoon</code> process.  For example, for the client-side of a TCP
plugin you might use the name &quot;TCPClient&quot; and for the server-side
you might use &quot;TCPServer&quot;.

</p></dd>
<dt><strong> objfile</strong></dt>
<dd><p>The object file into which traffic generation code is compiled.  For
most UNIX-like operating systems, this file will end in the extension
<code>.so</code>.  For MacOS X, this extension is normally <code>.dylib</code>.

</p></dd>
<dt><strong> maxthreads</strong></dt>
<dd><p>An integer defining the maximum number of threads to create for this
plugin.  One thread represents one Harpoon session.  Note
that different operating systems impose limits on the maximum number
of threads per process.  Harpoon will happily attempt to create one
million threads if you ask it to -- it is up to you to make sure this
number makes sense.  If Harpoon is unable to create the number of
threads you ask for it will croak, leaving both you and the formerly
running <code>harpoon</code> quite miserable.

</p></dd>
<dt><strong> personality</strong></dt>
<dd><p>This attribute should contain the value `<samp>server</samp>' or `<samp>client</samp>'.
Harpoon is organized as a client-server application.  This attribute
specifies how the traffic generator named in the configuration file should 
behave, either as a client or as a server.  More specifically, each plugin
module has two code entrypoints: <code>server_session</code> and 
<code>client_session</code>.  The entrypoint taken depends on this attribute.
See <a href="#SEC46">Creating New Traffic Generation Modules</a> for more details.
</p></dd>
</dl>

<hr size="6">
<a name="NOD17"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#SEC16" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC18" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC10" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC15" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#SEC21" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#SEC48" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="SEC17"></a>
<h3 class="subsection"> 3.5.2 Configuring Distributions </h3>

<p>Within a <code>&lt;plugin&gt;</code> element, you define the distribution data
used by the plugin.  Depending on the &quot;personality&quot; of the plugin and
on the particular traffic generator, different distributions may be required.  
For example, for the TCP client, file sizes are irrelevant since it is the 
server that generates files.  Note that the <code>config_validator</code> tool 
does not assume that <em>all</em> distributions are required and checks only 
for the existence of distributions that make sense based on the configured 
personality.

</p><p>As described in <a href="#SEC1">Overview of Harpoon</a> and summarized in
<a href="#ANC1">distributional parameters</a>, there are five distributions
comprising Harpoon's architectural model for TCP flows.  Configuration of 
three of those parameters is described here.  Addressing is described in the
following section.

</p><p>Each of the parameters <em>P_{FileSize</em>, <em>P_{InterConnection</em>,
<em>P_{ActiveSessions</em>, <em>P_{IPRange_{src</em>, and 
<em>P_{IPRange_{dest</em>
are configured using XML tags
<code>&lt;file_sizes&gt;</code>, <code>&lt;interconnection_times&gt;</code>, <code>&lt;active_sessions&gt;</code>, 
and <code>&lt;address_pool&gt;</code>, respectively, also
shown in the example below.  Whitespace-separated values for each
distribution should be written between start and end tags for the respective
element.  There is no required order among these tags.  
For the TCP plugin, servers expect <code>&lt;file_sizes&gt;</code> and 
<code>&lt;active_sessions&gt;</code>.  File sizes values are given in bytes.  
Clients expect <code>&lt;interconnection_times&gt;</code> and <code>&lt;active_sessions&gt;</code>.  
Interconnection times are given in (floating point) seconds.  Both endpoints
require <code>&lt;address_pool&gt;</code> tags, as described below.

</p><a name="IDX39"></a>
<p>The <code>&lt;active_sessions&gt;</code> tag identifies the number of Harpoon sessions
(threads) that should be active for a given interval.  By default, this
interval is assumed to be an 60 seconds, though it need not be so.  By
adjusting the &quot;warp factor&quot; (`<samp>-w</samp>' option, 
<a href="#ANC3">harpoon command-line parameters</a>)
on the <code>harpoon</code> command-line, any mapping between emulation
time and wall-clock time may be made.  The Harpoon plugin controller
will adjust the number of active threads per interval according to the
distribution given in <code>&lt;active_sessions&gt;</code>.  By default, Harpoon will
iterate <strong>once</strong> through the list of <code>&lt;active_sessions&gt;</code>, then
plugin activity will cease (<em>i.e.</em>, number of active sessions will
be set to 0).  For clients, this is often the desired behavior.  For servers,
however, this is very often not desirable.  The `<samp>-c</samp>' flag can be
given to Harpoon so that it cycles continuously over its list of
<code>&lt;active_sessions&gt;</code>.

</p><p>The <code>maxthreads</code> attribute described above serves as a cap to the
number of threads to be created for a plugin.  If values given for
<code>&lt;active_sessions&gt;</code> exceeds maxthreads, no threads beyond
<code>maxthreads</code> will be created.  For the client-side, the
relationship between the values given for <code>&lt;active_sessions&gt;</code> and
load generated by Harpoon should be straightforward.  For servers, it
is often best to simply supply one value (which should usually be the
same as the value given for <code>maxthreads</code>) so that enough server
handlers are running at all times.  Choosing this value is akin to
provisioning a web server, and the default values set by the Harpoon
configuration tools may or may not need tuning in different environments.

</p><p>The next two examples show how the three distributions described above
appear in configuration files.  For these examples, the plugin
headers (attributes) are not specified, only the applicable distributions.

</p><a name="IDX40"></a>
<p>For a TCP server, only the <code>&lt;active_sessions&gt;</code> and <code>&lt;file_sizes&gt;</code>
elements are required:
</p><table><tr><td>&nbsp;</td><td><pre class="smallexample">        &lt;plugin &hellip; &gt;
                &lt;!-- for a TCP server configuration --&gt;
                &lt;active_sessions&gt; 
                     47
                &lt;/active_sessions&gt;

                &lt;file_sizes&gt; 
                     200 42000 300 1200 5400 &hellip; 
                &lt;/file_sizes&gt;

                &hellip;
        &lt;/plugin&gt;
</pre></td></tr></table>
<a name="IDX41"></a>
<p>For a TCP client, only the <code>&lt;active_sessions&gt;</code> and 
<code>&lt;interconnection_times&gt;</code> elements are required:

</p><table><tr><td>&nbsp;</td><td><pre class="smallexample">        &lt;plugin &hellip; &gt;
                &lt;!-- for a TCP client configuration --&gt;
                &lt;active_sessions&gt; 
                     50 58 60 61 70 75 &hellip; 
                &lt;/active_sessions&gt;

                &lt;interconnection_times&gt; 
                     1.2 0.3 4.95 1.5 0.1 0.9  &hellip; 
                &lt;/interconnection_times&gt;

                &hellip;
        &lt;/plugin&gt;
</pre></td></tr></table>
<hr size="6">
<a name="NOD18"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#SEC17" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC19" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC10" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC15" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#SEC21" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#SEC48" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="SEC18"></a>
<h3 class="subsection"> 3.5.3 Configuring Addresses </h3>

<p>This section introduces the XML tags for configuring client source and
destinations addresses, and server addresses.  
The basic ideas are:
</p><ul>
<li><p> when clients make requests to servers, they bind to local
<em>source addresses</em> and ports, and connect to remote 
<em>destination addresses</em> and ports;
</p></li><li><p> servers bind to a server address and port, waiting for client
requests;
&nbsp;client source addresses can be specified, or can be set to allow the operating
system to assign a default local address (the same goes for servers).
</p></li></ul>

<p>All addresses (client source addresses, client destination addresses,
and server addresses) are defined using the XML tag <code>&lt;address_pool&gt;</code>,
but with different values for the required attribute <code>name</code>.
Within each address pool, there may be any number of <code>&lt;address&gt;</code> 
elements.  
Each <code>&lt;address&gt;</code> element must contain exactly two attributes:
<code>ipv4</code> and <code>port</code>.  The address element must be in a
CIDR-style format<a name="DOCF6" href="#FOOT6">(6)</a>.  
The port value
of 0 is a special value which indicates that the operating system
should automatically choose a local ephemeral port for the connection.
Likewise, the address &quot;0.0.0.0&quot; means that the client should bind to
the default local address, and the server should bind to &quot;*&quot;.
For server addresses, only one address and port should be defined: multihoming
in this way is not implemented yet.

</p><p>Note that these addresses say nothing about protocol.
Protocol-specific items are defined within plugin code.

</p><p>The address attribute name &quot;ipv4&quot; suggests that other kinds
of addresses are possible.  At present, only IPv4 addresses are
supported but it is conceivable that IPv6 will be supported in the
future.  Using any attribute for an address except &quot;ipv4&quot; will
generate a configuration file parse error.

</p><p>Continuing with the examples from above, the server address pool might
defined as:

</p><table><tr><td>&nbsp;</td><td><pre class="smallexample">        &lt;plugin &hellip; &gt;
                &lt;!-- for a TCP server configuration --&gt;
                &lt;active_sessions&gt; 
                     47
                &lt;/active_sessions&gt;

                &lt;file_sizes&gt; 
                     200 42000 300 1200 5400 &hellip; 
                &lt;/file_sizes&gt;

                &lt;address_pool name=&quot;server_address&quot;&gt;
                        &lt;address ipv4='0.0.0.0' port='10000'/&gt;
                &lt;/address_pool&gt;
        &lt;/plugin&gt;
</pre></td></tr></table>
<p>In this case, the server binds to &quot;*.10000&quot;.  That is, port 10000 for any
local address on the server.  For the client configuration, we define
a source address pool of 64 address (actually, 62 usable addresses, not 
including the host and broadcast addresses) and for destination addresses
we define two separate class C networks (254 usable addresses):

</p><table><tr><td>&nbsp;</td><td><pre class="smallexample">        &lt;plugin &hellip; &gt;
                &lt;!-- for a TCP client configuration --&gt;
                &lt;active_sessions&gt; 
                     50 58 60 61 70 75 &hellip; 
                &lt;/active_sessions&gt;

                &lt;interconnection_times&gt; 
                     1.2 0.3 4.95 1.5 0.1 0.9  &hellip; 
                &lt;/interconnection_times&gt;

                &lt;address_pool name=&quot;client_source_addresses&quot;&gt;
                        &lt;address ipv4='192.168.1.0/26' port='0' /&gt;
                &lt;/address_pool&gt;

                &lt;address_pool name=&quot;client_destination_addresses&quot;&gt;
                        &lt;address ipv4='192.168.47.0/24' port='10000'/&gt;
                        &lt;address ipv4='192.168.46.0/24' port='9900'/&gt;
                        &hellip;
                &lt;/address_pool&gt;
        &lt;/plugin&gt;
</pre></td></tr></table>
<a name="IDX42"></a>
<hr size="6">
<a name="NOD19"></a>
<a name="SEC19"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#SEC18" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC20" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC10" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC15" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#SEC21" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#SEC48" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h3 class="subsection"> 3.5.4 Putting It All Together </h3>

<p>To wrap up the examples in this section, we fill in the main plugin attributes
to complete the configuration files.  For the server:

</p><table><tr><td>&nbsp;</td><td><pre class="smallexample">        &lt;plugin name=&quot;ServerExample&quot; objfile=&quot;tcp_plugin.so&quot;
                maxthreads=&quot;47&quot;, personality=&quot;server&quot;&gt;

                &lt;!-- for a TCP server configuration --&gt;

                &lt;active_sessions&gt; 
                     47 
                &lt;/active_sessions&gt;

                &lt;file_sizes&gt; 
                     200 42000 300 1200 5400 &hellip; 
                &lt;/file_sizes&gt;

                &lt;address_pool name=&quot;server_address&quot;&gt;
                        &lt;address ipv4='0.0.0.0' port='10000'/&gt;
                &lt;/address_pool&gt;
        &lt;/plugin&gt;
</pre></td></tr></table>
<p>And for the client:

</p><table><tr><td>&nbsp;</td><td><pre class="smallexample">        &lt;plugin name=&quot;ClientExample&quot; objfile=&quot;tcp_plugin.so&quot;
                maxthreads=&quot;75&quot;, personality=&quot;client&quot;&gt;

                &lt;!-- for a TCP client configuration --&gt;

                &lt;active_sessions&gt; 
                     50 58 60 61 70 75 &hellip; 
                &lt;/active_sessions&gt;

                &lt;interconnection_times&gt; 
                     1.2 0.3 4.95 1.5 0.1 0.9  &hellip; 
                &lt;/interconnection_times&gt;

                &lt;address_pool name=&quot;client_source_addresses&quot;&gt;
                        &lt;address ipv4='192.168.1.0/26' port='0' /&gt;
                &lt;/address_pool&gt;

                &lt;address_pool name=&quot;client_destination_addresses&quot;&gt;
                        &lt;address ipv4='192.168.47.0/24' port='10000'/&gt;
                        &lt;address ipv4='192.168.46.0/24' port='9900'/&gt;
                        &hellip;
                &lt;/address_pool&gt;
        &lt;/plugin&gt;
</pre></td></tr></table>

<hr size="6">
<a name="NOD20"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#SEC19" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC21" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC10" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC15" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#SEC21" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#SEC48" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="SEC20"></a>
<h3 class="subsection"> 3.5.5 Nesting Configuration Files </h3>

<p>A feature of Harpoon configuration files is that one file may include
another, allowing a user of Harpoon to nest configuration files and
reuse identical distribution data in more than one plugin without
duplicating the data itself.  

</p><p>Using the tag <code>&lt;config_file&gt;</code> as in the example below causes the
named file to be substituted in place:

</p><table><tr><td>&nbsp;</td><td><pre class="smallexample">        &lt;plugin &hellip; &gt;
        &hellip;
        &lt;config_file&gt; file_sizes.xml &lt;/config_file&gt;
        &hellip;
        &lt;/plugin&gt;
</pre></td></tr></table>
<p>Assume the file <code>file_sizes.xml</code> contains:
</p><table><tr><td>&nbsp;</td><td><pre class="smallexample">        &lt;file_sizes&gt; 500 23423 837 7735 &lt;/file_sizes&gt;
</pre></td></tr></table>
<p>The resulting configuration would &quot;behave&quot; as if you had written:

</p><table><tr><td>&nbsp;</td><td><pre class="smallexample">        &lt;plugin &hellip; &gt;
        &hellip;
        &lt;file_sizes&gt; 500 23423 837 7735 &lt;/file_sizes&gt;
        &hellip;
        &lt;/plugin&gt;
</pre></td></tr></table>
<p>A very important thing to note is that each configuration file used by
Harpoon (whether it is a &quot;top-level&quot; configuration file or one that
is included by another) must be a well-formed XML document.  One
consequence is that files can contain only one top-level element.
Essentially, this means that a file containing exactly the following:

</p><table><tr><td>&nbsp;</td><td><pre class="smallexample">&lt;active_users&gt; 55 67 79 80 100 140 142 130 110 &lt;/active_users&gt;
&lt;file_sizes&gt; 500 23423 837 7735 &lt;/file_sizes&gt;
</pre></td></tr></table>
<p>is <strong>illegal</strong> -- the XML parser that Harpoon uses will
complain loudly.  You must structure your config files to accomodate
this restriction.  

</p><p>Another point to note (which will be described again below) is that
while you may use file names that include full or relative paths, any
relative paths will be relative to the working directory of the
<code>harpoon</code> executable.  Any plugin object files referenced in
configuration files will also be referred to relative to the working
directory of <code>harpoon</code>.

</p>



<hr size="6">
<a name="NOD21"></a>
<a name="SEC21"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#SEC20" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC22" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC10" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Top" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#SEC32" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#SEC48" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h1 class="chapter"> 4. Running Harpoon </h1>


<hr size="6">
<a name="SEC22"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#SEC21" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC23" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC21" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC21" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#SEC32" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#SEC48" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h2 class="section"> 4.1 The <code>harpoon</code> executable </h2>

<p><code>harpoon</code> is the executable used to load modules for traffic
generation.  Traffic generation is not implemented directly in
<code>harpoon</code>, it is rather a manager of traffic generation plugins.
Using command line parameters and an external management interface
(XML-RPC) you can load, unload, start, stop, and query traffic
generation modules.

</p><p><a name="ANC3"></a>
<a name="IDX43"></a>
<a name="IDX44"></a>
</p><hr size="6">
<a name="SEC23"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#SEC22" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC24" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC21" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC22" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#SEC32" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#SEC48" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h3 class="subsection"> 4.1.1 <code>harpoon</code> command-line parameters </h3>

<p>Most configuration is done through the external management interface, but
there are a few command line parameters for initial loading and configuration
of <code>harpoon</code>.  These parameters are:

</p><dl compact="compact">
<dt>`<samp> -f filename</samp>'</dt>
<dd><p>With the `<samp>-f</samp>' switch you specify
Harpoon config files to be initially loaded.  You may specify multiple
`<samp>-f</samp>' parameters in order to load more than one config file.

</p></dd>
<dt>`<samp> -l logfile</samp>'</dt>
<dd><p>The argument to the `<samp>-l</samp>' switch is a file name to which log
messages will be appended.  By default, log messages are written to
<code>STDERR</code>.

</p></dd>
<dt>`<samp> -p port</samp>'</dt>
<dd><p>The `<samp>-p</samp>' flag sets the port that
Harpoon's internal HTTP server listens on.  By default, this port is
8180.

</p></dd>
<dt>`<samp> -s seed</samp>'</dt>
<dd><p>The `<samp>-s</samp>' option sets a specific seed
for random number generation.  If this option is not set, the random
number generator is seeded using a combination of the current time and
Harpoon's process ID.

</p></dd>
<dt>`<samp> -v verbiage_level</samp>'</dt>
<dd><p>The `<samp>-v</samp>' option sets the
level of verbosity for log messages spewed by Harpoon.  The argument
to `<samp>-v</samp>' should be an integer from 0 to 10, with 0 meaning
minimal log messages are emitted, and 10 meaning lots of program
chatter is logged.

</p></dd>
<dt>`<samp> -w warp_factor</samp>'</dt>
<dd><p>With the `<samp>-w</samp>' switch, you may set the number of seconds that
comprise an <em>IntervalDuration</em>.  By default, this value is 60
seconds, so if the values given in <em>P_{ActiveUsers</em> represent
the number of active users per hour, it will take 24 minutes to
emulate a full day.  See the full Harpoon paper for some of the issues
in setting this parameter.

</p></dd>
<dt>`<samp> -c </samp>'</dt>
<dd><p>Use the `<samp>-c</samp>' flag to tell Harpoon to continuously cycle over its
values of <em>P_{ActiveSessions</em>.  The default behavior is for Harpoon to
spend <em>IntervalDuration</em> time on each value of <em>P_{ActiveSessions</em>,
successively stepping through the series of number of active sessions and 
stopping after the final value.  With the `<samp>-c</samp>' flag, Harpoon will 
cycle indefinitely over these <em>P_{ActiveUsers</em> values.

</p></dd>
<dt>`<samp> -a </samp>'</dt>
<dd><p>Use the `<samp>-a</samp>' switch to cause Harpoon to not automatically cycle through
the values in <em>P_{ActiveUsers</em>.  Using this flag, it is possible to
manually (through the XML-RPC interface) cycle through intervals.  Harpoon
will ignore the `<samp>-w</samp>' switch if `<samp>-a</samp>' is set.

</p></dd>
<dt>`<samp> -?</samp>'</dt>
<dd><p>This option dumps usage information on the above
command-line parameters.  Unrecognized options given to
<code>harpoon</code> also have this effect.
</p></dd>
</dl>

<p>In addition to <code>harpoon</code> command-line parameters described in
<a href="#ANC3">harpoon command-line parameters</a>, two run-time features to be aware of are signal handlers implemented by Harpoon, and event logging capability of 
Harpoon.

</p><a name="IDX45"></a>
<hr size="6">
<a name="SEC24"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#SEC23" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC25" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC21" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC22" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#SEC32" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#SEC48" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h3 class="subsection"> 4.1.2 Signals Handled by Harpoon </h3>

<p>The following table describes signals handled by Harpoon.  All other
signals are blocked.

</p><dl compact="compact">
<dt><code> SIGINT</code></dt>
<dt><code> SIGTERM</code></dt>
<dd><p>Sending an interrupt signal to Harpoon has the effect of shutting
Harpoon down.  First, all user-level threads running plugin code are
shut down, then the HTTP/XML-RPC listener is stopped.  Finally,
Harpoon crumples in a heap.

</p></dd>
<dt><code> SIGUSR1</code></dt>
<dd><p>Sending the USR1 signal has the effect of shutting down all user-level
plugin threads.  All plugins are returned to the idle state.  Harpoon
itself continues to process remote-interface method calls.

</p></dd>
<dt><code> SIGUSR2</code></dt>
<dd><p>Sending the USR2 signal to Harpoon causes all plugins to be reset
(analogous to the <code>resetAll()</code> XML-RPC method described below.)
First, all plugin threads are stopped, second, the emulated hour is
reset to 0, finally, plugin threads are restarted for all loaded
plugins.
</p></dd>
</dl>

<hr size="6">
<a name="NOD22"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#SEC24" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC26" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC21" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC22" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#SEC32" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#SEC48" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="SEC25"></a>
<h3 class="subsection"> 4.1.3 Harpoon Event Logging </h3>

<p>Logging capability within Harpoon is currently quite limited.  Using
the `<samp>-v</samp>' option to the <code>harpoon</code> executable causes
different levels of log messages to be written or suppressed.  All log
messages are currently written to <code>STDERR</code> by default, unless an
`<samp>-l</samp>' switch is given to <code>harpoon</code>.

</p><hr size="6">
<a name="NOD23"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#SEC25" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC27" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC21" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC22" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#SEC32" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#SEC48" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="SEC26"></a>
<h3 class="subsection"> 4.1.4 Environment Variables </h3>

<p>While there are no environment variables required specifically by
Harpoon, many operating systems will require setting the variable
<code>LD_LIBRARY_PATH</code> (or a similar variable, <em>e.g</em>, 
<code>DYLD_LIBRARY_PATH</code> on MacOS X) in order to make
dynamic loading of plugins work properly.  Before starting Harpoon,
this variable should be set to include the directory where plugin
modules are installed (often the same directory as Harpoon, but not
necessarily.)  You are advised to consult the relevant manual pages
for reference (e.g., <code>ldconfig</code> and <code>ld.so</code> for Linux,
<code>ld</code> and <code>ld.so.1</code> for Solaris, and <code>dyld</code> for MacOS
X.)

</p><p>A script, <code>run_harpoon.sh</code>, is supplied with the software distribution
to automatically set the above environment variable and then invoke
the harpoon executable.  If you perform a <code>make install</code> when
building Harpoon, this script will get installed and have the correct
paths.  If you do not install Harpoon, the script won't work (because of
default installation path settings).  If you want to use the script,
simply edit it to suit your needs.

</p>
<hr size="6">
<a name="NOD24"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#SEC26" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC28" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC21" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC21" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#SEC32" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#SEC48" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<p><a name="ANC4"></a>
</p><a name="SEC27"></a>
<h2 class="section"> 4.2 Validating a configuration file with <code>config_validator</code> </h2>

<p><code>config_validator</code> takes only one argument, the config file
to be checked.  It parses the given config file and prints diagnostics
on what was parsed.  Examples of config file validation are given in 
see section <a href="#SEC41">Validation of Configuration Files</a>.  The <code>config_validator</code>
uses the same code internally as Harpoon (and can be quite picky!) so
it really is a good idea to validate your config files using this tool.

</p><p>Another way to validate your config files is to use a general-purpose
XML schema validation tool.  One such tool on the Web is at
<a href="http://apps.gotdotnet.com/xmltools/xsdvalidator/Default.aspx">http://apps.gotdotnet.com/xmltools/xsdvalidator/Default.aspx</a>.
The file <code>harpoon_plugins.xsd</code> (see <a href="#ANC5">XML Configuration Schema</a>),
in the documentation directory of the Harpoon distribution, is an XML
schema defining the structure of Harpoon configuration files for the TCP
plugin.  (Note that this file <em>only</em> defines the structure for TCP
plugins, therefore its use is limited.  It is kept with the software
distribution mainly for historical reasons.)
For reference on XML schemas, see <a href="http://www.w3.org/XML/Schema">http://www.w3.org/XML/Schema</a>.
Note that schemas serve a similar purpose as SGML DTDs, but are
written entirely in XML.

</p><hr size="6">
<a name="NOD25"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#SEC27" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC29" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC21" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC21" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#SEC32" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#SEC48" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="SEC28"></a>
<h2 class="section"> 4.3 Self-configuration Tools </h2>

<p>This section describes the command-line options for the three self-configuration
tools, <code>harpoon_flowproc</code>, <code>harpoon_conf.py</code>, and 
<code>harpoon_reconf.py</code>.

</p><hr size="6">
<a name="NOD26"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#SEC28" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC30" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC21" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC28" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#SEC32" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#SEC48" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="SEC29"></a>
<h3 class="subsection"> 4.3.1 <code>harpoon_flowproc</code> </h3>

<p>The flow record processor tool takes the flow records as standard input
and produces a reformatted series of records (in ASCII) on standard
output.  There are a number of limitations to this program, making it
unsuitable for very large flow record traces. 

</p>
<dl compact="compact">
<dt>`<samp> -i</samp>'</dt>
<dd><p>One of the main tasks of <code>harpoon_flowproc</code> is to organize flow 
records into a series of &quot;sessions&quot;, which are connections between the
same IP host pair initiated within some duration of time.  The `<samp>-i</samp>' 
option allows the user to specify this duration of time in seconds.  By
default, a value of 60 seconds is used.  This value should also match the
value used for the `<samp>-i</samp>' to the <code>harpoon_conf.py</code> script.

</p></dd>
<dt>`<samp> -n</samp>'</dt>
<dd><p><code>harpoon_flowproc</code>, by default, expects to use <tt>flow-tools</tt> format
flow records (unless the <tt>flow-tools</tt> library is not found).  To use
Netflow 5 wire format records, use the `<samp>-n</samp>' flag.

</p></dd>
<dt>`<samp> -w</samp>'</dt>
<dd><p><code>harpoon_flowproc</code> performs &quot;flow surgery&quot; to coalesce flow records
adjacent in time that are very likely referencing the same flow.  By default,
only records containing <tt>SYN</tt> and <tt>FIN</tt> or <tt>RST</tt> flags will be used 
(&quot;well-formed&quot; flows).  To relax this requirement, use the `<samp>-w</samp>' flag.
Using this option, no flow records will be ignored based on lack of TCP flags.
Note that flow surgery will not be performed if there are no TCP flags
present, regardless whether the `<samp>-w</samp>' option is set.
</p></dd>
</dl>


<hr size="6">
<a name="NOD27"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#SEC29" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC31" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC21" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC28" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#SEC32" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#SEC48" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="SEC30"></a>
<h3 class="subsection"> 4.3.2 <code>harpoon_conf.py</code> </h3>

<p>The <code>harpoon_conf.py</code> Python script takes the output of 
<code>harpoon_flowproc</code> and produces XML configuration files that can
be used by Harpoon.  While the configuration files may need some manual
tweaking for a particular environment, they can often be used right away.
<code>harpoon_conf.py</code> has one required argument, the file produced
from running <code>harpoon_flowproc</code>.  All options listed below are 
not required.

</p><dl compact="compact">
<dt>`<samp> -s</samp>'</dt>
<dd><p>Specify the point in time (floating point seconds) after which items
from the input file should be used.  This is an absolute time (i.e., not
relative to the beginning of the trace).  You might use this flag if you
want to restrict <code>harpoon_conf.py</code> to only process output records
for a particular time interval.

</p></dd>
<dt>`<samp> -e</samp>'</dt>
<dd><p>Specify the point in time (floating point seconds) before which items
from the input file should be used.  This is an absolute time (i.e., not
relative to the beginning of the trace).  You'd probably use this flag in
conjunction with `<samp>-e</samp>' to only process output records
for a particular time interval.

</p></dd>
<dt>`<samp> -i</samp>'</dt>
<dd><p>Specify the value of <em>IntervalDuration</em> to use.  By default, a value
of 300 seconds is used.  Generally, a longer value such as 300 or 600 seconds
is best.

</p></dd>
<dt>`<samp> -m</samp>'</dt>
<dd><p>Specify the maximum number of lines to process from the input file.  This
option is probably less useful unless you're doing some debugging.  Normally,
using the `<samp>-s</samp>' and `<samp>-e</samp>' options are what you should really use
if you want to only process records over a particular time interval.

</p></dd>
<dt>`<samp> -p</samp>'</dt>
<dd><p>Specify a string to use as a prefix for output files.  If the string 
`<tt>testprefix</tt>' is used, for example, the XML configuration files
`<tt>testprefix_tcpclient.xml</tt>' and `<tt>testprefix_tcpserver.xml</tt>' will
be produced.  The default prefix is <code>harpoonconf</code>.

</p></dd>
<dt>`<samp> -d</samp>'</dt>
<dd><p>Turn on some debugging chatter.  Multiple `<samp>-d</samp>' options cause more
chatter.

</p></dd>
<dt>`<samp> -D</samp>'</dt>
<dd><p>Specify a client destination address pool as a CIDR prefix.  For example,
<code>-D '192.168.1.0/24'</code>.  The `<samp>-D</samp>' option may be specified 
multiple times.

</p></dd>
<dt>`<samp> -S</samp>'</dt>
<dd><p>Specify a client source address pool as a CIDR prefix.  For example,
<code>-S '192.168.2.0/24'</code>.  The `<samp>-D</samp>' option may be specified 
multiple times.
Note that the server address defaults to <code>0.0.0.0</code> with port 10000.

</p></dd>
</dl>


<hr size="6">
<a name="NOD28"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#SEC30" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC32" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC21" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC28" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#SEC32" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#SEC48" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="SEC31"></a>
<h3 class="subsection"> 4.3.3 <code>harpoon_reconf.py</code> </h3>

<p>The <code>harpoon_reconf.py</code> Python script reads existing client and
server config files and retunes them to produce specific traffic volumes.
Only bitrates can be specified at this time.

</p>
<dl compact="compact">
<dt>`<samp> -c</samp>'</dt>
<dd><p>Use this option to specify the client config file. This is a required option.

</p></dd>
<dt>`<samp> -s</samp>'</dt>
<dd><p>Use this option to specify the server config file.  This is a required option.

</p></dd>
<dt>`<samp> -i</samp>'</dt>
<dd><p>Specify the value of <em>IntervalDuration</em> with the `<samp>-i</samp>' option.
Default value is 300 seconds.

</p></dd>
<dt>`<samp> -r</samp>'</dt>
<dd><p>Specify the target rate in bits per second using this option.  This is
a required option.

</p></dd>
<dt>`<samp> -d</samp>'</dt>
<dd><p>Turn on debugging chatter.

</p></dd>
</dl>





<a name="IDX46"></a>
<a name="IDX47"></a>
<a name="IDX48"></a>
<hr size="6">
<a name="NOD29"></a>
<a name="SEC32"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#SEC31" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC33" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC21" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Top" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#SEC39" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#SEC48" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h1 class="chapter"> 5. Managing harpoon </h1>

<p>In addition to using XML for its config files, Harpoon includes a
restricted HTTP daemon which understands POST commands for XML-RPC,
and PUT commands for upload of configuration and plugin files.  These
interfaces can be used to remotely manage Harpoon daemons.  This chapter
describes a usage of a PHP script for web-based Harpoon management.  We
also give details on the XML-RPC / HTTP interfaces to Harpoon.

</p><hr size="6">
<a name="SEC33"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#SEC32" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC34" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC32" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC32" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#SEC39" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#SEC48" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h2 class="section"> 5.1 Web-based Management </h2>

<p>A PHP (<a href="http://www.php.net">http://www.php.net</a>) script (<code>manage_harpoon.php</code>) and some 
Javascript and CSS support files are included with Harpoon to facilitate 
large-scale management of Harpoon.  This section describes usage and design 
of this feature.

</p><p>Sorry - this script is not documented yet (and not fully tested anyway).

</p><hr size="6">
<a name="SEC34"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#SEC33" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC35" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC32" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC33" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#SEC39" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#SEC48" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h3 class="subsection"> 5.1.1 Using <code>manage_harpoon.php</code> </h3>
<p><strong>FIXME</strong>

</p><hr size="6">
<a name="SEC35"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#SEC34" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC36" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC32" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC33" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#SEC39" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#SEC48" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h3 class="subsection"> 5.1.2 Setting up Apache and PHP </h3>
<p><strong>FIXME</strong>

</p>
<hr size="6">
<a name="SEC36"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#SEC35" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC37" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC32" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC32" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#SEC39" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#SEC48" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h2 class="section"> 5.2 Lower-level Management Interfaces </h2>

<p>A restricted HTTP server is embedded in Harpoon which allows remote management
using XML-RPC.  The HTTP PUT method is also understood, allowing upload of
XML configuration files and plugin binaries to remote Harpoon daemons.  This
section describes these low-level details of managing Harpoon.  Normally, you
do not need to be concerned with these details unless the supplied web
interface is insufficient for your needs.

</p><a name="IDX49"></a>
<a name="IDX50"></a>
<hr size="6">
<a name="SEC37"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#SEC36" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC38" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC32" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC36" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#SEC39" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#SEC48" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h3 class="subsection"> 5.2.1 Supported XML-RPC Methods </h3>

<p>The following table lists all XML-RPC methods recognized by Harpoon.
The <code>harpoon</code> executable listens to port 8180 by default for
requests.  This can be changed with the `<samp>-p</samp>' switch, described
in See <a href="#ANC3">harpoon command-line parameters</a>.  There are simple Python scripts
supplied with the Harpoon distribution that demonstrate the basics of
making management RPCs.  For further reference, see
<a href="http://www.xmlrpc.org/">http://www.xmlrpc.org/</a> (there is a very useful tutorial
available at this site) and the Python documentation, available at
<a href="http://www.python.org/">http://www.python.org/</a>.
 
</p><p>A restriction to be aware of with the XML-RPC interface of Harpoon is
that it is <strong>single-threaded</strong>.  That is, it can only handle one
request at a time.  This implementation has the side-effect that any
call that blocks for some amount of time will prevent any subsequent
calls from executing until the blocked call finishes.  (The primary
reason for implementing the listener as a single thread is to limit
the number of threads used by <code>harpoon</code> itself, leaving as
many resources available as possible for user-level traffic generation
threads.)

</p><p>Simple scripts using each of the interfaces described below are provided
in the `<tt>cli</tt>' subdirectory.  You may also wish to look briefly the
<a href="#ANC2">stats.py tool example</a> for a concrete reference using one of these
interfaces.

</p><dl compact="compact">
<dt><code> system.listMethods</code></dt>
<dd><p>List all methods recognized by the server.  Other standard 
<code>system</code> interfaces, such as <code>system.methodSignature</code> and
<code>system.methodHelp</code> are not (yet) available.

</p></dd>
<dt><code> system.null</code></dt>
<dd><p>Ping the server.  Returns the string <code>null</code>.  No parameters are
expected.

</p></dd>
<dt><code> loadConfig</code></dt>
<dd><p>Load an XML configuration file.  The file name is given as a parameter
to this method.  The file name may include a relative path from the
working directory of <code>harpoon</code>.  Note that any configuration
files nested in the one currently being loaded (named by this method)
must also be named with paths relative to the working directory of
<code>harpoon</code>.  A boolean value is returned indicating success or
failure.

</p></dd>
<dt><code> unloadConfig</code></dt>
<dd><p>Unload a plugin configuration.  The plugin name is supplied as a
parameter to this method.  Any plugin state is destroyed (a la
unloadPlugin() -- see below), and configuration data for the plugin
is also destroyed.  The plugin must be idle for this method to
succeed.  A boolean value is returned indicating success or failure.

</p></dd>
<dt><code> queryPlugins</code></dt>
<dd><p>Returns a list of structures describing all plugin configurations that
have been loaded.  No parameters are expected.

</p></dd>
<dt><code> unloadPlugin</code></dt>
<dd><p>Unload the shared object implementing a plugin, leaving the
configuration in-tact.  One parameter is expected, the name of the
plugin.  The plugin must have been previously stopped for this call to
succeed.  Returns a string indicating success or failure.  This call
can be useful to destroy any static state retained by the plugin
across calls to <code>startPlugin</code> and <code>stopPlugin</code>.  That
is, any statistics held in static variables of the class implementing
the plugin are wiped clean as a side-effect.  A boolean value is returned
to indicate success or failure.

</p></dd>
<dt><code> loadPlugin</code></dt>
<dd><p>One parameter is required, the plugin name.  Load the shared object
for the plugin named in the parameter.  The plugin configuration must
already have been loaded for this call to succeed.  A boolean value is
returned indicating success or failure.

</p></dd>
<dt><code> stopPlugin</code></dt>
<dd><p>One parameter is required, the plugin name.  Stop all threads running
for the named plugin.  Returns a boolean indicating success or failure.
Note that this call may take non-negligible time because of delay in
gracefully stopping traffic generation threads.  Be patient.

</p></dd>
<dt><code> startPlugin</code></dt>
<dd><p>One parameter is required, the plugin name.  Starts user-level threads
for the named plugin.  If the shared object for the plugin has not
already been loaded, this loading is done as a side-effect of this
call.  The plugin must be idle and/or unloaded for this call to
succeed.  A boolean value is returned indicating success or failure.

</p></dd>
<dt><code> getStats</code></dt>
<dd><p>No parameters are expected.  Returns an array of structures indicating
status and statistics of Harpoon and all loaded plugins.

</p></dd>
<dt><code> resetAll</code></dt>
<dd><p>No parameters are expected.  Stops all running plugins, resets the
emulated hour to 0 (zero) and restarts all plugins.  A boolean value
indicating success or failure is returned.

</p></dd>
<dt><code> suicide</code></dt>
<dd><p>No parameters are expected.  Initiates a shutdown of all threads
inside Harpoon, including Harpoon itself.  A meaningless string is returned.
</p></dd>
</dl>


<a name="IDX51"></a>
<a name="IDX52"></a>
<a name="IDX53"></a>
<a name="IDX54"></a>
<hr size="6">
<a name="SEC38"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#SEC37" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC39" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC32" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC36" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#SEC39" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#SEC48" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h3 class="subsection"> 5.2.2 Uploading Files with HTTP <code>PUT</code> </h3>

<p>In addition to processing XML-RPC methods using the HTTP POST command
over port 8180, Harpoon also recognizes HTTP PUT commands.  Using PUT
can be useful in distributing configuration and plugin files across a
number of Harpoon processes.  No tools are distributed with Harpoon
for distributing files.  You are advised to use existing free tool
such as <code>curl</code> or <code>wget</code> for this task.  The
destination file name is given as the URI, and may include a relative
path.  Any preceeding forward slashes are discarded.

</p><p>Examples of uploading configuration files and plugins using <code>curl</code> are
given below:

</p><table><tr><td>&nbsp;</td><td><pre class="verbatim">$ curl --upload-file dummy_plugin.xml \ 
  http://10.2.0.2:8180/dummy_plugin.xml
 % Total % Recvd % Xferd Average Speed            Time            Curr.
                          Dload  Upload Total    Current  Left    Speed
100 961  0   0  100  961     0    961   0:00:01  0:00:00  0:00:01   961
100 963  0   2  100  961     2    961   0:00:01  0:00:00  0:00:01     0
$
$ curl --upload-file dummy_plugin.so \ 
  http://10.2.0.2:8180/test/dummy_plugin.so
 % Total % Recvd % Xferd Average Speed            Time            Curr.
                          Dload  Upload Total    Current  Left    Speed
 54 37563 0  0   54 20480   0    20480 0:00:01   0:00:00  0:00:01 20480
100 37565 0  2  100 37563   2    37563 0:00:01   0:00:00  0:00:01 2780k
$
</pre></td></tr></table>
<p>In the first example, an XML configuration file
(<code>dummy_plugin.xml</code>) is written to the
working directory of Harpoon.  In the second example, a shared object
plugin <code>dummy_plugin.so</code> is written to the <code>test</code>
subdirectory under the working directory of <code>harpoon</code>.

</p><p>Note that there are clear security consequences of the PUT command.  At
present there is <strong>no</strong> support for authentication or encryption of
transactions using SSL.  There is also at present no way disable the
XML-RPC interface.  These features may be added at a later date.

</p>




<hr size="6">
<a name="NOD30"></a>
<a name="SEC39"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#SEC38" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC40" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC32" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Top" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#SEC45" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#SEC48" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h1 class="appendix"> A. More Examples </h1>

<hr size="6">
<a name="SEC40"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#SEC39" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC41" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC39" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC39" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#SEC45" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#SEC48" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h2 class="appendixsec"> A.1 XML Configuration Files </h2>

<p>The following examples show portions of the configurations
`<tt>tcp_client_ex2.xml</tt>' and `<tt>tcp_server_ex2.xml</tt>' provided in 
the `<tt>examples</tt>' subdirectory of the Harpoon software distribution.
Not all distribution data is printed (noted by the ellipses in the
examples).

</p><p>First, the client configuration:
</p><table><tr><td>&nbsp;</td><td><pre class="smallexample">&lt;harpoon_plugins&gt;

  &lt;plugin name=&quot;TcpClient&quot; objfile=&quot;tcp_plugin.dylib&quot; 
          maxthreads=&quot;10&quot; personality=&quot;client&quot;&gt;

       &lt;active_sessions&gt; 10 &lt;/active_sessions&gt;

       &lt;interconnection_times&gt;
       ...
       3.993905 0.293601 2.127093 0.174206 0.391431 
       2.579116 0.273442 0.358623 0.173357 1.454077 
       ...
       &lt;/interconnection_times&gt;

       &lt;address_pool name=&quot;client_source_pool&quot;&gt;
            &lt;address ipv4=&quot;10.54.40.2/32&quot; port=&quot;0&quot; /&gt;
       &lt;/address_pool&gt;

       &lt;address_pool name=&quot;client_destination_pool&quot;&gt;
            &lt;address ipv4=&quot;10.54.40.1/32&quot; port=&quot;10000&quot; /&gt;
       &lt;/address_pool&gt;
  &lt;/plugin&gt;
&lt;/harpoon_plugins&gt;
</pre></td></tr></table>


<p>Now, for the server configuration:

</p>
<table><tr><td>&nbsp;</td><td><pre class="smallexample">&lt;harpoon_plugins&gt;
  &lt;plugin name=&quot;TcpServer&quot; objfile=&quot;tcp_plugin.dylib&quot; 
          maxthreads=&quot;37&quot; personality=&quot;server&quot;&gt;

      &lt;file_sizes&gt;
      ...
      1034 9710 559390 52641 2122 2643 16167 22667 23660 20271790 14009 
      ...
      &lt;/file_sizes&gt;

      &lt;active_sessions&gt; 37 &lt;/active_sessions&gt;

      &lt;address_pool name=&quot;server_pool&quot;&gt;
          &lt;address ipv4=&quot;0.0.0.0&quot; port=&quot;10000&quot; /&gt;
      &lt;/address_pool&gt;

  &lt;/plugin&gt;
&lt;/harpoon_plugins&gt;
</pre></td></tr></table>
<p>If you wish to use these files to produce a specific traffic volume
(bit rate), see 
<a href="#SEC14">[tuning traffic volume with harpoon_reconf.py]</a>, 
<a href="#SEC31">[harpoon_reconf.py command-line parameters ]</a>, 
or <a href="#SEC9">[basic use of harpoon_reconf.py]</a>.
You may also wish to change the addresses to match your environment.  See
<a href="#SEC7">[modifying configuration file addresses]</a> 
or <a href="#SEC18">[address configuration]</a> for that information.

</p>
<a name="IDX55"></a>
<a name="IDX56"></a>
<hr size="6">
<a name="NOD31"></a>
<a name="SEC41"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#SEC40" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC42" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC39" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC39" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#SEC45" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#SEC48" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h2 class="appendixsec"> A.2 Validation of Configuration Files </h2>

<p>We now validate the above configuration files and show the output of
<code>config_validator</code> for each.  (Note that there are slight local
modifications to these config files so the output will not exactly match
running <code>config_validator</code> on these same files in the Harpoon
software distribution.)

</p><table><tr><td>&nbsp;</td><td><pre class="smallexample">$ config_validator tcp_client_ex2.xml
loading ../examples/tcp_client_ex2.xml
bad address - no prefix len?
Checking load of TcpClient
name: TcpClient
objfile: tcp_plugin.dylib
maxthreads: 50
personality: client
client source pool:
address list:
        10.54.0.22 - 10.54.0.22 :0 (1)
client destination pool: 
address list:
        10.54.46.0 - 10.54.46.255 :10000 (256)

dumping distributions (first 10): 
active_sessions: 12 27 40 41 36 48 50 50 49 25 
interconnection_times: 3.99391 0.293601 2.12709 1.21451 0.409159 0.1121 
    0.580837 0.101379 0.724933 0.224031 
$
</pre></td></tr></table>

<table><tr><td>&nbsp;</td><td><pre class="smallexample">$ config_validator tcp_server_ex2.xml
loading ../examples/tcp_server_ex2.xml
bad address - no prefix len?
Checking load of TcpServer
name: TcpServer
objfile: tcp_plugin.dylib
maxthreads: 37
personality: server
server address pool:
address list:
        0.0.0.0 - 0.0.0.0 :10000 (1)

dumping distributions (first 10): 
active_sessions: 37 
file_sizes: 18643900 15150 807481 157679 23465 4930 39188 4418 56341 10863
</pre></td></tr></table>

<a name="IDX57"></a>
<a name="IDX58"></a>
<hr size="6">
<a name="SEC42"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#SEC41" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC43" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC39" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC39" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#SEC45" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#SEC48" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h2 class="appendixsec"> A.3 Example Using Two Hosts, Unidirectional Traffic </h2>

<p>For the above client and server configuration files, assuming that
the client source and destination addresses are set up correctly, we're
ready to start up Harpoon and generate traffic.

</p><p>For the server, you should see something like this:
</p><table><tr><td>&nbsp;</td><td><pre class="smallexample">$ export LD_LIBRARY_PATH=\ 
      $LD_LIBRARY_PATH:/home/jsommers/harpoon/src/plugins
$ ./harpoon -f ../examples/tcp_server_ex2.xml -v10 -w300 -c
loading ../examples/tcp_server_ex2.xml... bad address - no prefix len?
 finished.
Checking load of TcpServer
name: TcpServer
objfile: tcp_plugin.so
maxthreads: 37
personality: server
server address pool:
address list:
        0.0.0.0 - 0.0.0.0 :10000 (1)

dumping distributions (first 10): 
active_sessions: 37 
file_sizes: 15150 807481 157679 23465 4930 39188 4418 56341 10863 
11:06:04 sev(07) stopping plugin TcpServer
11:06:04 sev(00) TcpServer: plugin stopped - threads killed and reaped
11:06:04 sev(07) starting plugin TcpServer
11:06:04 sev(02) TcpServer: no plugin state existed on start - created
11:06:04 sev(01) TcpServer: started plugin with 37 threads.
11:06:04 sev(01) &lt;stopping plugins: TcpServer:ok &gt;\ 
   &lt;starting plugins: TcpServer:ok &gt;
11:06:04 sev(09) harpoon started.  verbosity&lt;10&gt;warp_factor&lt;300&gt;\
    autoincr?&lt;1&gt;continuousrun?&lt;0&gt;
11:06:04 sev(05) 000.00 - emulation time tick

&hellip;

<kbd>CTRL-c</kbd>
going down in a ball of flames...
$ 
</pre></td></tr></table>
<p>Note that:
</p><ol>
<li><p> the variable <code>LD_LIBRARY_PATH</code> was set prior to starting Harpoon,
and was specified using Bourne shell syntax;
</p></li><li><p> the start up script was not used, so the above variable had to be set;
</p></li><li><p> the `<samp>-c</samp>' flag was used so that Harpoon will continuously
cycle over its list of active sessions--this is typically what is desired
for a server;
</p></li><li><p> the sixth log line (starting &quot;<code>11:06:04 sev(01) &lt;stopping plugins: TcpServer:ok &gt;</code>&quot; indicated that initial starting of the plugin was successful 
(note that the plugin is first stopped and then started--this is normal);
</p></li><li><p> each log line has the wall-clock time (hour:minute:second), a 
severity indication (ranging from 0, most important, to 10, debug jabber), 
Harpoon emulation time (epoch.fractional epoch), and the actual log message
(note that the severity levels are currently rather inconsistent--sorry);
</p></li><li><p> the process was stopped by hitting <kbd>CTRL-c</kbd>.
</p></li></ol>

<p>The client side startup looks very similar, so it is not shown.  Using
either your own monitoring tools or the XML-RPC scripts (e.g., 
<code>stats.py</code>), you should be able to see evidence of traffic flowing.

</p>
<hr size="6">
<a name="NOD32"></a>
<a name="SEC43"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#SEC42" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC44" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC39" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC39" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#SEC45" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#SEC48" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h2 class="appendixsec"> A.4 Example Using Two Hosts, Bidirectional Traffic at Different Rates </h2>

<p>Taking the previous example, we now want to do the following:
</p><ol>
<li><p> move the installation to two different hosts;
</p></li><li><p> generate traffic in two directions;
</p></li><li><p> set up traffic so 10 Mbps is generated in one direction and
20 Mbps is generated in the other direction.
</p></li></ol>

<a name="IDX59"></a>
<a name="IDX60"></a>
<p>Assume that host A has an IP address of <code>10.0.1.1</code>, and host B has
an address of <code>10.0.1.2</code>.  Assume also that we want the volume to be
relatively steady over 300 second intervals.
It's easiest if we work backwards based
on the requirements above.  First, we want to find out how many active
sessions we need for generating 10Mbps, and how many sessions for 20 Mbps.
To accomplish this, we need to use the <code>harpoon_reconf.py</code> script:

</p><table><tr><td>&nbsp;</td><td><pre class="smallexample">$ harpoon_reconf.py -c tcp_client_ex2.xml -s tcp_server_ex2.xml -i 300 \ 
   -r 10000000 -d
target volume:  375000000.0
interval duration:  300
client conf file:  ../examples/tcp_client_ex2.xml
server conf file:  ../examples/tcp_server_ex2.xml
target: 375000000.0 carry: 0
targetbytes 375000000.0 simbytes 407692953 median 7 mean 6 \ 
   stdev 1.50339682726 max 9 flows 3758
number of sessions should be 6 to achieve volume of  375000000 bytes \ 
   (10000000.0 bits/sec)
</pre></td></tr></table>
<p>As arguments to <code>harpoon_reconf.py</code>, we supply the two existing
configuration files (`<tt>tcp_client_ex2.xml</tt>' and `<tt>tcp_server_ex2.xml</tt>'), 
the interval duration (300 seconds), and the desired rate (10000000 bits per 
second).  (We also supplied the `<samp>-d</samp>' flag to get a little more verbose
output.)  We see that there should be 6 sessions configured to produce
10 Mbps.  In a similar way, we find that there should be 11 sessions configured
to produce 20 Mbps.

</p><p>Next, we need to create some new configuration files based on our existing
files.  Since the source and destination addresses for our clients are 
different, we need two separate client configuration files.  We'll use 
default addresses for the server, so we only need one server config file
for both machines.

</p><p>The steps should be:
</p><ol>
<li><p> copy `<tt>tcp_client_ex2.xml</tt>' to `<tt>clientA.xml</tt>' and 
`<tt>clientB.xml</tt>';
</p></li><li><p> edit `<tt>clientA.xml</tt>' to have source address of <code>10.0.1.1</code>,
destination address of <code>10.0.1.2</code>, and number of active sessions 
as the single value 6 (also make sure that <code>maxthreads</code> attribute
is set to at least 6);
</p></li><li><p> edit `<tt>clientB.xml</tt>' to have source address of <code>10.0.1.2</code>,
destination address of <code>10.0.1.1</code>, and number of active sessions 
as the single value 11 (also make sure that <code>maxthreads</code> attribute
is set to at least 11);
</p></li><li><p> move `<tt>clientA.xml</tt>' and a copy of `<tt>tcp_server_ex2.xml</tt>' to
host A, and `<tt>clientB.xml</tt>' and a copy of `<tt>tcp_server_ex2.xml</tt>' to
host B;
</p></li><li><p> start up servers;
</p></li><li><p> start up clients.
</p></li></ol>

<p>Once we start things up, we see that the 10 second averages over one 50
second period (in the 10Mbps direction) are: 15212977, 10309469, 9073456, 
9846232, 14869665, which gives an average of about 11.8Mbps.  Over a longer
period, the average comes closer to 10Mbps, though generally will never
be exactly 10Mbps.  It should, however, be close over the range of an
interval duration.  Again, the quality of the match depends on a number 
of things, including the interval duration, the maximum inter-connection
time (specified when using the self-configuration tools),
and the nature of the inter-connection
and file size distributions (heavy-tailed distributions need to be sampled
over a long duration for the sample mean to come close to the distributional
mean).

</p><p>For the 20Mbps direction, we also take 10 second averages using SNMP.  Over
a 160 second duration, the samples are: 
14028319, 23009625, 19027488, 20827397, 31798955, 32786164, 13115353, 15678779, 
13945478, 11020225, 14158496, 10773346, 15449599, 18931181, 24803243, 26993437
which gives an average of 19.1Mbps--pretty close to 20Mbps, even over
a shorter interval and the specified 300 seconds.

</p><hr size="6">
<a name="SEC44"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#SEC43" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC45" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC39" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC39" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#SEC45" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#SEC48" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h2 class="appendixsec"> A.5 Example with Three Hosts </h2>

<p>Finally, we want to do the following:
</p><ol>
<li><p> set up two client machines (A and B) to make requests to a single server;
</p></li><li><p> generate 10 Mbps on reverse path to client A, and 5 Mbps on reverse path
to client B;
</p></li><li><p> set up two server processes to handle the load, so that one process
serves client A, and the other process serves client B.
</p></li></ol>

<p>To our network of hosts A and B, we add a new machine, host C, with IP address
<code>10.0.1.3</code>.  We'll use host C as our server.

</p><p>The easiest thing is to set up the server config files.  Since we want
to set up two processes to handle the server load, we'll need two configuration
files:
</p><ol>
<li><p> copy the original server config file `<tt>tcp_server_ex2.xml</tt>' to
`<tt>serverA.xml</tt>' and `<tt>serverB.xml</tt>';
</p></li><li><p> edit `<tt>serverA.xml</tt>' to listen on port 10001 for client connections
from host A (find the address pool toward the end of the file);
</p></li><li><p> edit `<tt>serverB.xml</tt>' to listen on port 10002 for client connections
from host B (find the address pool toward the end of the file);
</p></li><li><p> move these two config files to host C.
</p></li></ol>

<p>The server processes can now be started.  You may wish to start them in
the background, writing to separate log files.  The other item you should
be aware of is that the XML-RPC ports should be set differently from the
default, otherwise these servers will clash.  Assuming we've already
set <code>LD_LIBRARY_PATH</code>, the start up lines should be something like:

</p><table><tr><td>&nbsp;</td><td><pre class="smallexample">$ harpoon -f serverA.xml -p 8181 -l serverA.log -w300 -c -v10 &amp;
$ harpoon -f serverB.xml -p 8182 -l serverB.log -w300 -c -v10 &amp;
</pre></td></tr></table>
<p>Now, we need to set up the client config files.  Since we already set the 
client source address in the previous example (see see <a href="../example with two hosts and bidirectional traffic/Example-Using-Two-Hosts.html">Bidirectional Traffic at Different Rates: (example with two hosts and bidirectional traffic)Example Using Two Hosts</a>), we just need to set the destination addresses and ports
correctly, and set the number of active sessions to produce the desired
volumes.

</p><a name="IDX61"></a>
<p>First, we need to find out how many sessions should be active to produce
5Mbps:
</p><table><tr><td>&nbsp;</td><td><pre class="smallexample">$ harpoon_reconf.py -c clientB.xml -s serverB.xml -i 300 -r 5000000 -d
target volume:  187500000.0
interval duration:  300
client conf file:  ../examples/tcp_client_ex2.xml
server conf file:  ../examples/tcp_server_ex2.xml
target: 187500000.0 carry: 0
targetbytes 187500000.0 simbytes 209525866 median 4 mean 3 \ 
   stdev 0.891882585016 max 5 flows 2050
number of sessions should be 3 to achieve volume of  187500000 bytes \ 
   (5000000.0 bits/sec)
</pre></td></tr></table>
<p><code>harpoon_reconf.py</code> shows that there should be three sessions active
to produce 5Mbps.  

</p><p>Now, we can edit the client config files and start the clients up:
</p><ol>
<li><p> edit `<tt>clientA.xml</tt>' to have host C (<code>10.0.1.3</code>) as the 
destination address and 10001 for the destination port
(note that we already have the number of active sessions set to produce
10Mbps);
</p></li><li><p> edit `<tt>clientB.xml</tt>' to have host C (<code>10.0.1.3</code>) as the
destination address and 10002 for the destination port;
</p></li><li><p> also in `<tt>clientB.xml</tt>', set the number of active sessions to three.
</p></li></ol>

<p>Now, start up the clients:
</p><table><tr><td>&nbsp;</td><td><pre class="smallexample">hostA$ harpoon -f clientA.xml -w300 -v10
&hellip;
hostB$ harpoon -f clientB.xml -w300 -v10
</pre></td></tr></table>
<a name="IDX62"></a>
<p>After a while, we check the server A process to see how much traffic
is being generated using the <code>stats.py</code> script:

</p><table><tr><td>&nbsp;</td><td><pre class="smallexample">$ stats.py -u http://hostC:8181/
stats for  &lt;ServerProxy for hostC:8181/&gt;
server-wide information:
        emulation_interval   0
----
plugin-specific information:

        TcpServer is running - up for  117  seconds
                target threads = 37  active threads = 37
                num_transfer = 639
                send_bandwidth_total_bps = 4588290.0
                send_bandwidth_recent_bps = 5593370.0
                bytes_sent_total = 67103700.0
                bytes_sent_recent = 53137000.0
                personality = server
</pre></td></tr></table>
<p>We see that about 5Mbps is being generated, which is what we wanted.

</p><p>Note that for all these examples, we have not specified any physical 
connections, any emulated round-trip times, routes, or the like.  These
configuration settings are outside the domain of Harpoon.  You should
set these parameters based on requirements for your tests.  You should
also be aware that changing these network parameters (as opposed to
application layer parameters in Harpoon) can make very significant
differences in the nature of the generated traffic.  Refer to the
Harpoon technical paper for examples of such differences.  

</p>
<a name="IDX63"></a>
<p><a name="ANC5"></a>
</p><hr size="6">
<a name="SEC45"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#SEC44" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC46" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC39" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Top" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#SEC46" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#SEC48" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h1 class="appendix"> B. XML Configuration Schema </h1>

<p>The schema defining TCP plugin configuration files is given below for 
reference.  (This file lives in the documentation subdirectory of the
Harpoon software distribution.)  Someday maybe there will be a nice parser 
generator to justify this file's existence.  (But then I'll have to
fix the logical bugs in the file...)

</p>
<table><tr><td>&nbsp;</td><td><pre class="verbatim">
&lt;xsd:schema xmlns:xsd=&quot;http://www.w3.org/2001/XMLSchema&quot;&gt;

&lt;xsd:annotation&gt;
   &lt;xsd:documentation xml:lang=&quot;en&quot;&gt;

   this is an xml schema for harpoon configuration files.
   copyright 2004 joel sommers.

   an xml schema is a way to define the structure of xml documents using
   xml itself.  note that dtd (document type definitions) have a similar
   function, yet are written using sgml rather than xml.  for more 
   info, see: http://www.w3.org/TR/xmlschema-1/.  a useful validator
   on the web is at: 
   http://apps.gotdotnet.com/xmltools/xsdvalidator/Default.aspx.  

   &lt;!--
        $Id: harpoon_manual.html,v 1.2 2005/12/07 17:07:00 jsommers Exp $
     --&gt;

   &lt;/xsd:documentation&gt;
&lt;/xsd:annotation&gt;


&lt;xsd:element name=&quot;harpoon_plugins&quot; type=&quot;pluginList&quot; /&gt;

&lt;xsd:complexType name=&quot;pluginList&quot;&gt;
  &lt;xsd:sequence&gt;
    &lt;xsd:element name=&quot;plugin&quot; 
                 minOccurs=&quot;1&quot; maxOccurs=&quot;unbounded&quot; 
                 type=&quot;pluginSpecifier&quot; /&gt; 
  &lt;/xsd:sequence&gt;
&lt;/xsd:complexType&gt;


&lt;xsd:complexType name=&quot;pluginSpecifier&quot;&gt;
   &lt;xsd:sequence&gt;
      &lt;xsd:element name=&quot;config_file&quot; type=&quot;xsd:string&quot; 
                   minOccurs=&quot;0&quot; maxOccurs=&quot;unbounded&quot; /&gt;

      &lt;!-- 
        NB: these element are only required for implementation of TCP 
        sources, and there are different specific requirements at
        a server or client (which are not specified in this schema).
        also, there are different elements required for different 
        sources.  refer to the manual...

        NB: also, defining the sub-elements of the plugin as a sequence
        is overly restrictive, since they must appear in the same order
        as below.  in the actual code, we don't make that restriction;
        elements can appear in any order.
        --&gt;

      &lt;xsd:element name=&quot;interconnection_times&quot; type=&quot;float_list&quot; 
                   minOccurs=&quot;0&quot; maxOccurs=&quot;unbounded&quot; /&gt;

      &lt;xsd:element name=&quot;active_sessions&quot; type=&quot;int_list&quot; 
                   minOccurs=&quot;0&quot;  maxOccurs=&quot;unbounded&quot; /&gt;

      &lt;xsd:element name=&quot;file_sizes&quot; type=&quot;int_list&quot; 
                   minOccurs=&quot;0&quot;  maxOccurs=&quot;unbounded&quot; /&gt;

      &lt;xsd:element name=&quot;address_pool&quot; type=&quot;addressList&quot;
                   minOccurs=&quot;0&quot; maxOccurs=&quot;unbounded&quot; /&gt;

  &lt;/xsd:sequence&gt;

  &lt;xsd:attribute name=&quot;name&quot; type=&quot;xsd:string&quot; use=&quot;required&quot;/&gt;
  &lt;xsd:attribute name=&quot;objfile&quot; type=&quot;xsd:string&quot; use=&quot;required&quot;/&gt;
  &lt;xsd:attribute name=&quot;maxthreads&quot; type=&quot;xsd:int&quot; use=&quot;required&quot;/&gt;
  &lt;xsd:attribute name=&quot;personality&quot; type=&quot;personalityType&quot; 
                 use=&quot;optional&quot;/&gt;

&lt;/xsd:complexType&gt;


&lt;xsd:simpleType name=&quot;int_list&quot;&gt;
  &lt;xsd:list itemType=&quot;xsd:unsignedLong&quot;/&gt;
&lt;/xsd:simpleType&gt;

&lt;xsd:simpleType name=&quot;float_list&quot;&gt;
  &lt;xsd:list itemType=&quot;xsd:float&quot;/&gt;
&lt;/xsd:simpleType&gt;

&lt;xsd:simpleType name=&quot;personalityType&quot;&gt;
  &lt;xsd:restriction base=&quot;xsd:string&quot;&gt;
    &lt;xsd:enumeration value=&quot;client&quot;/&gt;
    &lt;xsd:enumeration value=&quot;server&quot;/&gt;
    &lt;xsd:enumeration value=&quot;unknown&quot;/&gt;
  &lt;/xsd:restriction&gt;
&lt;/xsd:simpleType&gt;

&lt;xsd:simpleType name=&quot;addressPoolType&quot;&gt;
  &lt;xsd:restriction base=&quot;xsd:string&quot;&gt;
    &lt;xsd:enumeration value=&quot;client_source_pool&quot;/&gt;
    &lt;xsd:enumeration value=&quot;client_destination_pool&quot;/&gt;
    &lt;xsd:enumeration value=&quot;server_pool&quot;/&gt;
  &lt;/xsd:restriction&gt;
&lt;/xsd:simpleType&gt;

&lt;xsd:complexType name=&quot;addressList&quot;&gt;
   &lt;xsd:sequence&gt;
      &lt;xsd:element name=&quot;address&quot; 
                   minOccurs=&quot;1&quot; maxOccurs=&quot;unbounded&quot; 
                   type=&quot;addressSpecifier&quot;/&gt;
   &lt;/xsd:sequence&gt;
   &lt;xsd:attribute name=&quot;name&quot; type=&quot;addressPoolType&quot; use=&quot;required&quot;/&gt;
&lt;/xsd:complexType&gt;

&lt;xsd:complexType name=&quot;addressSpecifier&quot;&gt;
  &lt;xsd:attribute name=&quot;ipv4&quot; type=&quot;ipv4Type&quot; use=&quot;required&quot;/&gt;

  &lt;!-- NB: not restrictive enough --&gt;
  &lt;xsd:attribute name=&quot;port&quot; type=&quot;xsd:nonNegativeInteger&quot; 
                 use=&quot;required&quot;/&gt;
&lt;/xsd:complexType&gt;

&lt;xsd:simpleType name=&quot;ipv4Type&quot;&gt;
  &lt;xsd:restriction base=&quot;xsd:string&quot;&gt;
     &lt;!-- NB: not completely accurate, but sufficient for now --&gt;
     &lt;xsd:pattern value=&quot;\d{1,3}(\.\d{1,3}){0,3}(\/(\d+)){0,1}&quot; /&gt;
  &lt;/xsd:restriction&gt;
&lt;/xsd:simpleType&gt;

&lt;/xsd:schema&gt;
</pre></td></tr></table>


<a name="IDX64"></a>
<hr size="6">
<a name="NOD33"></a>
<a name="SEC46"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#SEC45" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC47" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC45" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Top" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#SEC47" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#SEC48" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h1 class="appendix"> C. Creating New Traffic Generation Modules </h1>

<p>Creating a new traffic generation module can be as simple as
subclassing the <code>HarpoonPlugin</code> class.  There are five pure
virtual methods that must be overwritten to accomplish this:

</p><ul>
<li><p> <code>bool init(HarpoonPluginConfig*)</code>

</p></li><li><p> <code>void client_session(void)</code>

</p></li><li><p> <code>void server_session(void)</code>

</p></li><li><p> <code>void stats(std::ostream&amp;)</code>

</p></li><li><p> <code>void shutdown(void)</code>

</p></li></ul>

<p>A toy example is given below.  It is a good idea to review the
documentation and code for the <code>TCPPlugin</code> before attempting to
write your own plugin.  

</p><p>Note in the example below that the C symbol <code>factory_generator</code> is the
symbol for which <code>harpoon</code> searches.  This function returns just
returns a new traffic generator object that implements the five specific 
entrypoints named above.

</p><p>There are some tricks to maintaining common data structures for a plugin. 
See the <code>TCPPlugin</code> for documentation and an example of this behavior.

</p>
<a name="IDX65"></a>
<a name="IDX66"></a>
<a name="IDX67"></a>
<table><tr><td>&nbsp;</td><td><pre class="verbatim">class DummyPlugin : public HarpoonPlugin
{
public:
   DummyPlugin() : HarpoonPlugin() {}
   virtual ~DummyPlugin() {}

   // plugin general, and thread specific configuration.  this method
   // is called for every thread, so you must be careful not to
   // re-initialize anything.
   virtual bool init(HarpoonPluginConfig *hpc)
   {
       HarpoonPlugin::init(hpc);
       return true;
   }

   // if plugin personality is client, this method is called
   virtual void client_session()
   {
       std::cerr &lt;&lt; &quot;dummy client session begin&quot; &lt;&lt; std::endl;
       sleep(10);
       std::cerr &lt;&lt; &quot;dummy client session end&quot; &lt;&lt; std::endl;
   }

   // if plugin personality is server, this method is called
   virtual void server_session()
   {
       std::cerr &lt;&lt; &quot;dummy server session begin&quot; &lt;&lt; std::endl;
       sleep(10);
       std::cerr &lt;&lt; &quot;dummy server session end&quot; &lt;&lt; std::endl;
   }

   // called for all threads when the plugin is being shut down.
   virtual void shutdown()
   {
       std::cerr &lt;&lt; &quot;dummy shutdown&quot; &lt;&lt; std::endl;
       return;
   }

   // best to check your own personality here to decide what stats
   // to return.
   virtual void stats(std::ostream &amp;os)
   {
       XmlRpcUtil::encode_struct_value(os, &quot;dummystats&quot;, &quot;no stats!&quot;);
   }
};

/*
 * factory function.  &quot;factory_generator&quot; is the C symbol we look for
 * when loading harpoon plugins.  (We use a C factory function to get
 * around C++ name mangling issues.)
 */
extern &quot;C&quot;
{
  Harpoon::DummyPlugin *factory_generator(void)
  {
     return (new Harpoon::DummyPlugin()); 
  }
}
</pre></td></tr></table>

<hr size="6">
<a name="NOD34"></a>
<a name="SEC47"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#SEC46" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC48" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC46" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Top" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#SEC48" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#SEC48" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h1 class="unnumbered"> Postscript </h1>

<p>The full technical paper describing Harpoon appeared in the Internet 
Measurement Conference, Taormina, Sicily, Italy, in October 2004
(<a href="http://www.cs.wisc.edu/~jsommers/pubs/p173-sommers.pdf">http://www.cs.wisc.edu/~jsommers/pubs/p173-sommers.pdf</a>).
Harpoon first appeared as an extended poster at the SIGMETRICS conference, 
New York, New York, USA, in June 2004
(<a href="http://portal.acm.org/citation.cfm?doid=1005686.1005733">http://portal.acm.org/citation.cfm?doid=1005686.1005733</a>).  

</p><p>Thanks to Jeff Sommers for making the Harpoon icon.  Thanks to Dave 
Plonka at the University of Wisconsin for help understanding limitations of
flow records.  

</p>


<hr size="6">
<a name="NOD35"></a>
<a name="SEC48"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#SEC47" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[ &gt; ]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC47" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Top" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[ &gt;&gt; ]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#SEC48" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h1 class="unnumbered"> Index </h1>

<table><tr><th valign="top">Jump to: &nbsp; </th><td><a href="#SEC48_0" class="summary-letter"><b>A</b></a>
 &nbsp; 
<a href="#SEC48_1" class="summary-letter"><b>B</b></a>
 &nbsp; 
<a href="#SEC48_2" class="summary-letter"><b>C</b></a>
 &nbsp; 
<a href="#SEC48_3" class="summary-letter"><b>D</b></a>
 &nbsp; 
<a href="#SEC48_4" class="summary-letter"><b>E</b></a>
 &nbsp; 
<a href="#SEC48_5" class="summary-letter"><b>F</b></a>
 &nbsp; 
<a href="#SEC48_6" class="summary-letter"><b>G</b></a>
 &nbsp; 
<a href="#SEC48_7" class="summary-letter"><b>H</b></a>
 &nbsp; 
<a href="#SEC48_8" class="summary-letter"><b>I</b></a>
 &nbsp; 
<a href="#SEC48_9" class="summary-letter"><b>M</b></a>
 &nbsp; 
<a href="#SEC48_10" class="summary-letter"><b>P</b></a>
 &nbsp; 
<a href="#SEC48_11" class="summary-letter"><b>R</b></a>
 &nbsp; 
<a href="#SEC48_12" class="summary-letter"><b>S</b></a>
 &nbsp; 
<a href="#SEC48_13" class="summary-letter"><b>T</b></a>
 &nbsp; 
<a href="#SEC48_14" class="summary-letter"><b>V</b></a>
 &nbsp; 
<a href="#SEC48_15" class="summary-letter"><b>X</b></a>
 &nbsp; 
</td></tr></table><table border="0" class="index-cp">
<tr><td></td><th align="left">Index Entry</th><th align="left"> Section</th></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="SEC48_0">A</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#IDX10">active sessions distribution</a></td><td valign="top"><a href="#SEC2">1.1 Architecture of Harpoon</a></td></tr>
<tr><td></td><td valign="top"><a href="#IDX39">active sessions distribution</a></td><td valign="top"><a href="#SEC17">3.5.2 Configuring Distributions</a></td></tr>
<tr><td></td><td valign="top"><a href="#IDX9">address range distributions</a></td><td valign="top"><a href="#SEC2">1.1 Architecture of Harpoon</a></td></tr>
<tr><td></td><td valign="top"><a href="#NOD18">address range distributions</a></td><td valign="top"><a href="#SEC18">3.5.3 Configuring Addresses</a></td></tr>
<tr><td></td><td valign="top"><a href="#IDX26">addressing</a></td><td valign="top"><a href="#SEC6">2.1 Validating a Configuration</a></td></tr>
<tr><td></td><td valign="top"><a href="#NOD18">addressing</a></td><td valign="top"><a href="#SEC18">3.5.3 Configuring Addresses</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="SEC48_1">B</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#IDX18">building the software</a></td><td valign="top"><a href="#SEC3">1.2 Harpoon Software Components</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="SEC48_2">C</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#IDX19">compiling</a></td><td valign="top"><a href="#SEC3">1.2 Harpoon Software Components</a></td></tr>
<tr><td></td><td valign="top"><a href="#IDX23">config file validation</a></td><td valign="top"><a href="#SEC5">2. Basic Configuration</a></td></tr>
<tr><td></td><td valign="top"><a href="#NOD24">config file validation</a></td><td valign="top"><a href="#SEC27">4.2 Validating a configuration file with <code>config_validator</code></a></td></tr>
<tr><td></td><td valign="top"><a href="#IDX55">config file validation</a></td><td valign="top"><a href="#SEC40">A.1 XML Configuration Files</a></td></tr>
<tr><td></td><td valign="top"><a href="#IDX51">configuration file distribution</a></td><td valign="top"><a href="#SEC37">5.2.1 Supported XML-RPC Methods</a></td></tr>
<tr><td></td><td valign="top"><a href="#SEC15">configuration file example</a></td><td valign="top"><a href="#SEC15">3.5 Configuration File Structure</a></td></tr>
<tr><td></td><td valign="top"><a href="#IDX42">configuration file example</a></td><td valign="top"><a href="#SEC18">3.5.3 Configuring Addresses</a></td></tr>
<tr><td></td><td valign="top"><a href="#SEC39">configuration file example</a></td><td valign="top"><a href="#SEC39">A. More Examples</a></td></tr>
<tr><td></td><td valign="top"><a href="#IDX58">configuration file example</a></td><td valign="top"><a href="#SEC41">A.2 Validation of Configuration Files</a></td></tr>
<tr><td></td><td valign="top"><a href="#IDX24">configuration file structure</a></td><td valign="top"><a href="#SEC6">2.1 Validating a Configuration</a></td></tr>
<tr><td></td><td valign="top"><a href="#IDX35">configuration file structure</a></td><td valign="top"><a href="#SEC9">2.4 Modifying a Configuration to Produce Different Traffic Volumes</a></td></tr>
<tr><td></td><td valign="top"><a href="#SEC15">configuration file structure</a></td><td valign="top"><a href="#SEC15">3.5 Configuration File Structure</a></td></tr>
<tr><td></td><td valign="top"><a href="#NOD20">configuration file structure</a></td><td valign="top"><a href="#SEC20">3.5.5 Nesting Configuration Files</a></td></tr>
<tr><td></td><td valign="top"><a href="#SEC39">configuration file structure</a></td><td valign="top"><a href="#SEC39">A. More Examples</a></td></tr>
<tr><td></td><td valign="top"><a href="#IDX56">configuration file structure</a></td><td valign="top"><a href="#SEC40">A.1 XML Configuration Files</a></td></tr>
<tr><td></td><td valign="top"><a href="#IDX37">configuring</a></td><td valign="top"><a href="#SEC10">3. Advanced Configuration</a></td></tr>
<tr><td></td><td valign="top"><a href="#NOD25">configuring</a></td><td valign="top"><a href="#SEC28">4.3 Self-configuration Tools</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="SEC48_3">D</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#IDX12">distributional parameters</a></td><td valign="top"><a href="#SEC2">1.1 Architecture of Harpoon</a></td></tr>
<tr><td></td><td valign="top"><a href="#NOD17">distributional parameters</a></td><td valign="top"><a href="#SEC17">3.5.2 Configuring Distributions</a></td></tr>
<tr><td></td><td valign="top"><a href="#IDX6">distributions</a></td><td valign="top"><a href="#SEC2">1.1 Architecture of Harpoon</a></td></tr>
<tr><td></td><td valign="top"><a href="#NOD17">distributions</a></td><td valign="top"><a href="#SEC17">3.5.2 Configuring Distributions</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="SEC48_4">E</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#IDX20">environment variables</a></td><td valign="top"><a href="#SEC4">1.2.1 Building the Harpoon Software</a></td></tr>
<tr><td></td><td valign="top"><a href="#NOD23">environment variables</a></td><td valign="top"><a href="#SEC26">4.1.4 Environment Variables</a></td></tr>
<tr><td></td><td valign="top"><a href="#NOD23">environment variables</a></td><td valign="top"><a href="#SEC26">4.1.4 Environment Variables</a></td></tr>
<tr><td></td><td valign="top"><a href="#NOD22">event logging</a></td><td valign="top"><a href="#SEC25">4.1.3 Harpoon Event Logging</a></td></tr>
<tr><td></td><td valign="top"><a href="#IDX21">example configurations</a></td><td valign="top"><a href="#SEC5">2. Basic Configuration</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="SEC48_5">F</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#IDX7">file size distribution</a></td><td valign="top"><a href="#SEC2">1.1 Architecture of Harpoon</a></td></tr>
<tr><td></td><td valign="top"><a href="#IDX40">file size distribution</a></td><td valign="top"><a href="#SEC17">3.5.2 Configuring Distributions</a></td></tr>
<tr><td></td><td valign="top"><a href="#IDX2">flow-level architecture</a></td><td valign="top"><a href="#SEC1">1. Overview of Harpoon</a></td></tr>
<tr><td></td><td valign="top"><a href="#IDX4">flow-level architecture</a></td><td valign="top"><a href="#SEC2">1.1 Architecture of Harpoon</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="SEC48_6">G</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#IDX1">getting started</a></td><td valign="top"><a href="#SEC1">1. Overview of Harpoon</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="SEC48_7">H</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#IDX28">harpoon command-line options</a></td><td valign="top"><a href="#SEC8">2.3 Starting Harpoon</a></td></tr>
<tr><td></td><td valign="top"><a href="#IDX43">harpoon command-line parameters</a></td><td valign="top"><a href="#SEC22">4.1 The <code>harpoon</code> executable</a></td></tr>
<tr><td></td><td valign="top"><a href="#IDX3">harpoon high-level architecture</a></td><td valign="top"><a href="#SEC2">1.1 Architecture of Harpoon</a></td></tr>
<tr><td></td><td valign="top"><a href="#IDX15">harpoon tools</a></td><td valign="top"><a href="#SEC2">1.1 Architecture of Harpoon</a></td></tr>
<tr><td></td><td valign="top"><a href="#NOD14">harpoon_conf.py tool</a></td><td valign="top"><a href="#SEC13">3.3 The <code>harpoon_conf.py</code> tool</a></td></tr>
<tr><td></td><td valign="top"><a href="#NOD27">harpoon_conf.py tool</a></td><td valign="top"><a href="#SEC30">4.3.2 <code>harpoon_conf.py</code></a></td></tr>
<tr><td></td><td valign="top"><a href="#NOD13">harpoon_flowproc tool</a></td><td valign="top"><a href="#SEC12">3.2 The <code>harpoon_flowproc</code> tool</a></td></tr>
<tr><td></td><td valign="top"><a href="#NOD26">harpoon_flowproc tool</a></td><td valign="top"><a href="#SEC29">4.3.1 <code>harpoon_flowproc</code></a></td></tr>
<tr><td></td><td valign="top"><a href="#IDX30">harpoon_reconf.py tool</a></td><td valign="top"><a href="#SEC8">2.3 Starting Harpoon</a></td></tr>
<tr><td></td><td valign="top"><a href="#NOD15">harpoon_reconf.py tool</a></td><td valign="top"><a href="#SEC14">3.4 The <code>harpoon_reconf.py</code> tool</a></td></tr>
<tr><td></td><td valign="top"><a href="#NOD28">harpoon_reconf.py tool</a></td><td valign="top"><a href="#SEC31">4.3.3 <code>harpoon_reconf.py</code></a></td></tr>
<tr><td></td><td valign="top"><a href="#IDX60">harpoon_reconf.py tool</a></td><td valign="top"><a href="#SEC43">A.4 Example Using Two Hosts, Bidirectional Traffic at Different Rates</a></td></tr>
<tr><td></td><td valign="top"><a href="#IDX61">harpoon_reconf.py tool</a></td><td valign="top"><a href="#SEC44">A.5 Example with Three Hosts</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="SEC48_8">I</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#IDX8">inter-connection time distribution</a></td><td valign="top"><a href="#SEC2">1.1 Architecture of Harpoon</a></td></tr>
<tr><td></td><td valign="top"><a href="#IDX41">inter-connection time distribution</a></td><td valign="top"><a href="#SEC17">3.5.2 Configuring Distributions</a></td></tr>
<tr><td></td><td valign="top"><a href="#IDX11">interval duration</a></td><td valign="top"><a href="#SEC2">1.1 Architecture of Harpoon</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="SEC48_9">M</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#IDX47">managing harpoon</a></td><td valign="top"><a href="#SEC31">4.3.3 <code>harpoon_reconf.py</code></a></td></tr>
<tr><td></td><td valign="top"><a href="#IDX53">managing harpoon</a></td><td valign="top"><a href="#SEC37">5.2.1 Supported XML-RPC Methods</a></td></tr>
<tr><td></td><td valign="top"><a href="#IDX25">modifying addresses</a></td><td valign="top"><a href="#SEC6">2.1 Validating a Configuration</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="SEC48_10">P</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#IDX5">parameters</a></td><td valign="top"><a href="#SEC2">1.1 Architecture of Harpoon</a></td></tr>
<tr><td></td><td valign="top"><a href="#IDX13">parameters</a></td><td valign="top"><a href="#SEC2">1.1 Architecture of Harpoon</a></td></tr>
<tr><td></td><td valign="top"><a href="#IDX65">plugin code example</a></td><td valign="top"><a href="#SEC46">C. Creating New Traffic Generation Modules</a></td></tr>
<tr><td></td><td valign="top"><a href="#IDX52">plugin file</a></td><td valign="top"><a href="#SEC37">5.2.1 Supported XML-RPC Methods</a></td></tr>
<tr><td></td><td valign="top"><a href="#IDX67">plugin file</a></td><td valign="top"><a href="#SEC46">C. Creating New Traffic Generation Modules</a></td></tr>
<tr><td></td><td valign="top"><a href="#IDX17">plugins</a></td><td valign="top"><a href="#SEC3">1.2 Harpoon Software Components</a></td></tr>
<tr><td></td><td valign="top"><a href="#IDX38">plugins</a></td><td valign="top"><a href="#SEC15">3.5 Configuration File Structure</a></td></tr>
<tr><td></td><td valign="top"><a href="#IDX66">plugins</a></td><td valign="top"><a href="#SEC46">C. Creating New Traffic Generation Modules</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="SEC48_11">R</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#IDX48">remote management</a></td><td valign="top"><a href="#SEC31">4.3.3 <code>harpoon_reconf.py</code></a></td></tr>
<tr><td></td><td valign="top"><a href="#IDX54">remote management</a></td><td valign="top"><a href="#SEC37">5.2.1 Supported XML-RPC Methods</a></td></tr>
<tr><td></td><td valign="top"><a href="#IDX44">running harpoon</a></td><td valign="top"><a href="#SEC22">4.1 The <code>harpoon</code> executable</a></td></tr>
<tr><td></td><td valign="top"><a href="#IDX27">running harpoon, example</a></td><td valign="top"><a href="#SEC7">2.2 Modifying Configuration File Addresses</a></td></tr>
<tr><td></td><td valign="top"><a href="#IDX57">running harpoon, example</a></td><td valign="top"><a href="#SEC41">A.2 Validation of Configuration Files</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="SEC48_12">S</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#IDX36">self-configuration</a></td><td valign="top"><a href="#SEC10">3. Advanced Configuration</a></td></tr>
<tr><td></td><td valign="top"><a href="#NOD25">self-configuration tools</a></td><td valign="top"><a href="#SEC28">4.3 Self-configuration Tools</a></td></tr>
<tr><td></td><td valign="top"><a href="#IDX45">signal handling</a></td><td valign="top"><a href="#SEC23">4.1.1 <code>harpoon</code> command-line parameters</a></td></tr>
<tr><td></td><td valign="top"><a href="#IDX14">software components</a></td><td valign="top"><a href="#SEC2">1.1 Architecture of Harpoon</a></td></tr>
<tr><td></td><td valign="top"><a href="#IDX29">stats.py tool</a></td><td valign="top"><a href="#SEC8">2.3 Starting Harpoon</a></td></tr>
<tr><td></td><td valign="top"><a href="#IDX32">stats.py tool</a></td><td valign="top"><a href="#SEC9">2.4 Modifying a Configuration to Produce Different Traffic Volumes</a></td></tr>
<tr><td></td><td valign="top"><a href="#IDX62">stats.py tool</a></td><td valign="top"><a href="#SEC44">A.5 Example with Three Hosts</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="SEC48_13">T</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#IDX64">traffic generation plugins</a></td><td valign="top"><a href="#SEC45">B. XML Configuration Schema</a></td></tr>
<tr><td></td><td valign="top"><a href="#IDX16">traffic generator plugins</a></td><td valign="top"><a href="#SEC3">1.2 Harpoon Software Components</a></td></tr>
<tr><td></td><td valign="top"><a href="#IDX31">traffic volume, tuning</a></td><td valign="top"><a href="#SEC8">2.3 Starting Harpoon</a></td></tr>
<tr><td></td><td valign="top"><a href="#IDX59">traffic volume, tuning</a></td><td valign="top"><a href="#SEC43">A.4 Example Using Two Hosts, Bidirectional Traffic at Different Rates</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="SEC48_14">V</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#IDX22">validating configuration files</a></td><td valign="top"><a href="#SEC5">2. Basic Configuration</a></td></tr>
<tr><td></td><td valign="top"><a href="#NOD24">validating configuration files</a></td><td valign="top"><a href="#SEC27">4.2 Validating a configuration file with <code>config_validator</code></a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="SEC48_15">X</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#IDX34">XML configuration file structure</a></td><td valign="top"><a href="#SEC9">2.4 Modifying a Configuration to Produce Different Traffic Volumes</a></td></tr>
<tr><td></td><td valign="top"><a href="#SEC15">XML configuration file structure</a></td><td valign="top"><a href="#SEC15">3.5 Configuration File Structure</a></td></tr>
<tr><td></td><td valign="top"><a href="#NOD20">XML configuration file structure</a></td><td valign="top"><a href="#SEC20">3.5.5 Nesting Configuration Files</a></td></tr>
<tr><td></td><td valign="top"><a href="#SEC39">XML configuration file structure</a></td><td valign="top"><a href="#SEC39">A. More Examples</a></td></tr>
<tr><td></td><td valign="top"><a href="#NOD24">XML configuration files</a></td><td valign="top"><a href="#SEC27">4.2 Validating a configuration file with <code>config_validator</code></a></td></tr>
<tr><td></td><td valign="top"><a href="#IDX63">XML configuration schema</a></td><td valign="top"><a href="#SEC44">A.5 Example with Three Hosts</a></td></tr>
<tr><td></td><td valign="top"><a href="#IDX33">XML-RPC management</a></td><td valign="top"><a href="#SEC9">2.4 Modifying a Configuration to Produce Different Traffic Volumes</a></td></tr>
<tr><td></td><td valign="top"><a href="#IDX46">XML-RPC management</a></td><td valign="top"><a href="#SEC31">4.3.3 <code>harpoon_reconf.py</code></a></td></tr>
<tr><td></td><td valign="top"><a href="#IDX49">XML-RPC management</a></td><td valign="top"><a href="#SEC36">5.2 Lower-level Management Interfaces</a></td></tr>
<tr><td></td><td valign="top"><a href="#IDX50">XML-RPC methods</a></td><td valign="top"><a href="#SEC36">5.2 Lower-level Management Interfaces</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
</table><table><tr><th valign="top">Jump to: &nbsp; </th><td><a href="#SEC48_0" class="summary-letter"><b>A</b></a>
 &nbsp; 
<a href="#SEC48_1" class="summary-letter"><b>B</b></a>
 &nbsp; 
<a href="#SEC48_2" class="summary-letter"><b>C</b></a>
 &nbsp; 
<a href="#SEC48_3" class="summary-letter"><b>D</b></a>
 &nbsp; 
<a href="#SEC48_4" class="summary-letter"><b>E</b></a>
 &nbsp; 
<a href="#SEC48_5" class="summary-letter"><b>F</b></a>
 &nbsp; 
<a href="#SEC48_6" class="summary-letter"><b>G</b></a>
 &nbsp; 
<a href="#SEC48_7" class="summary-letter"><b>H</b></a>
 &nbsp; 
<a href="#SEC48_8" class="summary-letter"><b>I</b></a>
 &nbsp; 
<a href="#SEC48_9" class="summary-letter"><b>M</b></a>
 &nbsp; 
<a href="#SEC48_10" class="summary-letter"><b>P</b></a>
 &nbsp; 
<a href="#SEC48_11" class="summary-letter"><b>R</b></a>
 &nbsp; 
<a href="#SEC48_12" class="summary-letter"><b>S</b></a>
 &nbsp; 
<a href="#SEC48_13" class="summary-letter"><b>T</b></a>
 &nbsp; 
<a href="#SEC48_14" class="summary-letter"><b>V</b></a>
 &nbsp; 
<a href="#SEC48_15" class="summary-letter"><b>X</b></a>
 &nbsp; 
</td></tr></table>
<hr size="6">
<a name="SEC_Foot"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#SEC48" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h1>Footnotes</h1>
<h3><a name="FOOT1" href="#DOCF1">(1)</a></h3>

<p><a href="http://www.cisco.com/univercd/cc/td/doc/cisintwk/intsolns/netflsol/nfwhite.htm">http://www.cisco.com/univercd/cc/td/doc/cisintwk/intsolns/netflsol/nfwhite.htm</a>.
</p><h3><a name="FOOT2" href="#DOCF2">(2)</a></h3>
<p>See, for example, Vern Paxson's thesis
(<a href="ftp://ftp.ee.lbl.gov/papers/vp-thesis/dis.ps.gz">ftp://ftp.ee.lbl.gov/papers/vp-thesis/dis.ps.gz</a>).
</p><h3><a name="FOOT3" href="#DOCF3">(3)</a></h3>
<p><a href="http://expat.sourceforge.net">http://expat.sourceforge.net</a>
</p><h3><a name="FOOT4" href="#DOCF4">(4)</a></h3>
<p><a href="http://www.splintered.net/sw/flow-tools">http://www.splintered.net/sw/flow-tools</a>
</p><h3><a name="FOOT5" href="#DOCF5">(5)</a></h3>
<p><a href="http://www.python.org">http://www.python.org</a>
</p><h3><a name="FOOT6" href="#DOCF6">(6)</a></h3>
<p>A current limitation with this scheme is
that all four bytes of an IPv4 address must be given even for short
prefixes.  Instead of writing <code>10.5/16</code>, you should write
<code>10.5.0.0/16</code>.
</p><hr size="1">
<a name="SEC_Contents"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#SEC48" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h1>Table of Contents</h1>
<div class="contents">

<ul class="toc">
  <li><a name="TOC1" href="#SEC1">1. Overview of Harpoon</a>
  <ul class="toc">
    <li><a name="TOC2" href="#SEC2">1.1 Architecture of Harpoon</a></li>
    <li><a name="TOC3" href="#SEC3">1.2 Harpoon Software Components</a>
    <ul class="toc">
      <li><a name="TOC4" href="#SEC4">1.2.1 Building the Harpoon Software</a></li>
    </ul>
</li>
  </ul></li>
  <li><a name="TOC5" href="#SEC5">2. Basic Configuration</a>
  <ul class="toc">
    <li><a name="TOC6" href="#SEC6">2.1 Validating a Configuration</a></li>
    <li><a name="TOC7" href="#SEC7">2.2 Modifying Configuration File Addresses</a></li>
    <li><a name="TOC8" href="#SEC8">2.3 Starting Harpoon</a></li>
    <li><a name="TOC9" href="#SEC9">2.4 Modifying a Configuration to Produce Different Traffic Volumes</a></li>
  </ul></li>
  <li><a name="TOC10" href="#SEC10">3. Advanced Configuration</a>
  <ul class="toc">
    <li><a name="TOC11" href="#SEC11">3.1 Self-Configuration Tools</a></li>
    <li><a name="TOC12" href="#SEC12">3.2 The <code>harpoon_flowproc</code> tool</a></li>
    <li><a name="TOC13" href="#SEC13">3.3 The <code>harpoon_conf.py</code> tool</a></li>
    <li><a name="TOC14" href="#SEC14">3.4 The <code>harpoon_reconf.py</code> tool</a></li>
    <li><a name="TOC15" href="#SEC15">3.5 Configuration File Structure</a>
    <ul class="toc">
      <li><a name="TOC16" href="#SEC16">3.5.1 <code>&lt;plugin&gt;</code> Definitions</a></li>
      <li><a name="TOC17" href="#SEC17">3.5.2 Configuring Distributions</a></li>
      <li><a name="TOC18" href="#SEC18">3.5.3 Configuring Addresses</a></li>
      <li><a name="TOC19" href="#SEC19">3.5.4 Putting It All Together</a></li>
      <li><a name="TOC20" href="#SEC20">3.5.5 Nesting Configuration Files</a></li>
    </ul>
</li>
  </ul></li>
  <li><a name="TOC21" href="#SEC21">4. Running Harpoon</a>
  <ul class="toc">
    <li><a name="TOC22" href="#SEC22">4.1 The <code>harpoon</code> executable</a>
    <ul class="toc">
      <li><a name="TOC23" href="#SEC23">4.1.1 <code>harpoon</code> command-line parameters</a></li>
      <li><a name="TOC24" href="#SEC24">4.1.2 Signals Handled by Harpoon</a></li>
      <li><a name="TOC25" href="#SEC25">4.1.3 Harpoon Event Logging</a></li>
      <li><a name="TOC26" href="#SEC26">4.1.4 Environment Variables</a></li>
    </ul></li>
    <li><a name="TOC27" href="#SEC27">4.2 Validating a configuration file with <code>config_validator</code></a></li>
    <li><a name="TOC28" href="#SEC28">4.3 Self-configuration Tools</a>
    <ul class="toc">
      <li><a name="TOC29" href="#SEC29">4.3.1 <code>harpoon_flowproc</code></a></li>
      <li><a name="TOC30" href="#SEC30">4.3.2 <code>harpoon_conf.py</code></a></li>
      <li><a name="TOC31" href="#SEC31">4.3.3 <code>harpoon_reconf.py</code></a></li>
    </ul>
</li>
  </ul></li>
  <li><a name="TOC32" href="#SEC32">5. Managing harpoon</a>
  <ul class="toc">
    <li><a name="TOC33" href="#SEC33">5.1 Web-based Management</a>
    <ul class="toc">
      <li><a name="TOC34" href="#SEC34">5.1.1 Using <code>manage_harpoon.php</code></a></li>
      <li><a name="TOC35" href="#SEC35">5.1.2 Setting up Apache and PHP</a></li>
    </ul></li>
    <li><a name="TOC36" href="#SEC36">5.2 Lower-level Management Interfaces</a>
    <ul class="toc">
      <li><a name="TOC37" href="#SEC37">5.2.1 Supported XML-RPC Methods</a></li>
      <li><a name="TOC38" href="#SEC38">5.2.2 Uploading Files with HTTP <code>PUT</code></a></li>
    </ul>
</li>
  </ul></li>
  <li><a name="TOC39" href="#SEC39">A. More Examples</a>
  <ul class="toc">
    <li><a name="TOC40" href="#SEC40">A.1 XML Configuration Files</a></li>
    <li><a name="TOC41" href="#SEC41">A.2 Validation of Configuration Files</a></li>
    <li><a name="TOC42" href="#SEC42">A.3 Example Using Two Hosts, Unidirectional Traffic</a></li>
    <li><a name="TOC43" href="#SEC43">A.4 Example Using Two Hosts, Bidirectional Traffic at Different Rates</a></li>
    <li><a name="TOC44" href="#SEC44">A.5 Example with Three Hosts</a></li>
  </ul></li>
  <li><a name="TOC45" href="#SEC45">B. XML Configuration Schema</a></li>
  <li><a name="TOC46" href="#SEC46">C. Creating New Traffic Generation Modules</a></li>
  <li><a name="TOC47" href="#SEC47">Postscript</a></li>
  <li><a name="TOC48" href="#SEC48">Index</a></li>
</ul>
</div>
<hr size="1">
<a name="SEC_About"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#SEC_Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#SEC48" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h1>About This Document</h1>
<p>
  This document was generated by <em>joel sommers</em> on <em>December, 7 2005</em> using <a href="http://texi2html.cvshome.org/"><em>texi2html 1.70</em></a>.
</p>
<p>
  The buttons in the navigation panels have the following meaning:
</p>
<table border="1">
  <tr>
    <th> Button </th>
    <th> Name </th>
    <th> Go to </th>
    <th> From 1.2.3 go to</th>
  </tr>
  <tr>
    <td align="center"> [ &lt; ] </td>
    <td align="center">Back</td>
    <td>previous section in reading order</td>
    <td>1.2.2</td>
  </tr>
  <tr>
    <td align="center"> [ &gt; ] </td>
    <td align="center">Forward</td>
    <td>next section in reading order</td>
    <td>1.2.4</td>
  </tr>
  <tr>
    <td align="center"> [ &lt;&lt; ] </td>
    <td align="center">FastBack</td>
    <td>beginning of this chapter or previous chapter</td>
    <td>1</td>
  </tr>
  <tr>
    <td align="center"> [ Up ] </td>
    <td align="center">Up</td>
    <td>up section</td>
    <td>1.2</td>
  </tr>
  <tr>
    <td align="center"> [ &gt;&gt; ] </td>
    <td align="center">FastForward</td>
    <td>next chapter</td>
    <td>2</td>
  </tr>
  <tr>
    <td align="center"> [Top] </td>
    <td align="center">Top</td>
    <td>cover (top) of document</td>
    <td> &nbsp; </td>
  </tr>
  <tr>
    <td align="center"> [Contents] </td>
    <td align="center">Contents</td>
    <td>table of contents</td>
    <td> &nbsp; </td>
  </tr>
  <tr>
    <td align="center"> [Index] </td>
    <td align="center">Index</td>
    <td>index</td>
    <td> &nbsp; </td>
  </tr>
  <tr>
    <td align="center"> [ ? ] </td>
    <td align="center">About</td>
    <td>about (help)</td>
    <td> &nbsp; </td>
  </tr>
</table>

<p>
  where the <strong> Example </strong> assumes that the current position is at <strong> Subsubsection One-Two-Three </strong> of a document of the following structure:
</p>

<ul>
  <li> 1. Section One
    <ul>
      <li>1.1 Subsection One-One
        <ul>
          <li>...</li>
        </ul>
      </li>
      <li>1.2 Subsection One-Two
        <ul>
          <li>1.2.1 Subsubsection One-Two-One</li>
          <li>1.2.2 Subsubsection One-Two-Two</li>
          <li>1.2.3 Subsubsection One-Two-Three &nbsp; &nbsp;
            <strong>&lt;== Current Position </strong></li>
          <li>1.2.4 Subsubsection One-Two-Four</li>
        </ul>
      </li>
      <li>1.3 Subsection One-Three
        <ul>
          <li>...</li>
        </ul>
      </li>
      <li>1.4 Subsection One-Four</li>
    </ul>
  </li>
</ul>

<hr size="1">
<p>
 <font size="-1">
  This document was generated by <em>joel sommers</em> on <em>December, 7 2005</em> using <a href="http://texi2html.cvshome.org/"><em>texi2html 1.70</em></a>.
 </font>
 <br>

</p>
</body>
</html>
